项目名称,项目URL,提交ID,提交者,提交时间,提交信息,提交链接
postgres/postgres,https://github.com/postgres/postgres,a4a0fa0,Álvaro Herrera,2025-12-05T15:16:27Z,"Stabilize tests some more  Tests added by commits 90eae926abbb, 2bc7e886fc1b, bc32a12e0db2 have occasionally failed, depending on timing.  Add some dependency markers to the spec to try and remove the instability.  Author: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Discussion: https://postgr.es/m/202512041739.sgg3tb2yobe2@alvherre.pgsql",https://github.com/postgres/postgres/commit/a4a0fa0c7587eb05b36c1f184d966dd5524a4b74
postgres/postgres,https://github.com/postgres/postgres,4d936c3,Heikki Linnakangas,2025-12-05T09:32:38Z,"Fix setting next multixid's offset at offset wraparound  In commit 789d65364c, we started updating the next multixid's offset too when recording a multixid, so that it can always be used to calculate the number of members. I got it wrong at offset wraparound: we need to skip over offset 0. Fix that.  Discussion: https://www.postgresql.org/message-id/d9996478-389a-4340-8735-bfad456b313c@iki.fi Backpatch-through: 14",https://github.com/postgres/postgres/commit/4d936c3fff1ac8dead2cc240ba3da2ed6337257c
postgres/postgres,https://github.com/postgres/postgres,31d3847,Michael Paquier,2025-12-05T07:40:26Z,"Use more palloc_object() and palloc_array() in contrib/  The idea is to encourage more the use of these new routines across the tree, as these offer stronger type safety guarantees than palloc().  In an ideal world, palloc() would then act as an internal routine of these flavors, whose footprint in the tree is minimal.  The patch sent by the author is very large, and this chunk of changes represents something like 10% of the overall patch submitted.  The code compiled is the same before and after this commit, using objdump to do some validation with a difference taken in-between.  There are some diffs, which are caused by changes in line numbers because some of the new allocation formulas are shorter, for the following files: trgm_regexp.c, xpath.c and pg_walinspect.c.  Author: David Geier <geidav.pg@gmail.com> Discussion: https://postgr.es/m/ad0748d4-3080-436e-b0bc-ac8f86a3466a@gmail.com",https://github.com/postgres/postgres/commit/31d3847a37bec060fb4177b2fc6c0fdfc7a08011
postgres/postgres,https://github.com/postgres/postgres,2f04110,Michael Paquier,2025-12-05T05:15:21Z,"Improve test output of extended statistics for ndistinct and dependencies  Corey Huinker has come up with a recipe that is more compact and more pleasant to the eye for extended stats because we know that all of them are 1-dimension JSON arrays.  This commit switches the extended stats tests to use replace() instead of jsonb_pretty(), splitting the data so as one line is used for each item in the extended stats object.  This results in the removal of a good chunk of test output, that is now easier to debug with one line used for each item in a stats object. This patch has not been provided by Corey.  This is some post-commit cleanup work that I have noticed as good enough to do on its own while reviewing the rest of the patch set Corey has posted.  Discussion: https://postgr.es/m/CADkLM=csMd52i39Ye8-PUUHyzBb3546eSCUTh-FBQ7bzT2uZ4Q@mail.gmail.com",https://github.com/postgres/postgres/commit/2f04110225ab30fbd9889d6f5d73fd6b3e1b308b
postgres/postgres,https://github.com/postgres/postgres,5db6a34,Amit Kapila,2025-12-05T04:12:55Z,"Rename column slotsync_skip_at to slotsync_last_skip.  Commit 76b78721ca introduced two new columns in pg_stat_replication_slots to improve monitoring of slot synchronization. One of these columns was named slotsync_skip_at, which is inconsistent with the naming convention used for similar columns in other system views.  Columns that store timestamps of the most recent event typically use the 'last_' in the column name (e.g., last_autovacuum, checksum_last_failure). Renaming slotsync_skip_at to slotsync_last_skip aligns with this pattern, making the purpose of the column clearer and improving overall consistency across the views.  Author: Shlok Kyal <shlok.kyal.oss@gmail.com> Reviewed-by: Michael Banck <mbanck@gmx.net> Discussion: https://postgr.es/m/20251128091552.GB13635@p46.dedyn.io;lightning.p46.dedyn.io Discussion: https://postgr.es/m/CAE9k0PkhfKrTEAsGz4DjOhEj1nQ+hbQVfvWUxNacD38ibW3a1g@mail.gmail.com",https://github.com/postgres/postgres/commit/5db6a344abc2dfbc5df454cd93a096443ea4dd3e
postgres/postgres,https://github.com/postgres/postgres,7bc88c3,Michael Paquier,2025-12-05T03:30:43Z,"Fix some compiler warnings  Some of the buildfarm members with some old gcc versions have been complaining about an always-true test for a NULL pointer caused by a combination of SOFT_ERROR_OCCURRED() and a local ErrorSaveContext variable.  These warnings are taken care of by removing SOFT_ERROR_OCCURRED(), switching to a direct variable check, like 56b1e88c804b.  Oversights in e1405aa5e3ac and 44eba8f06e55.  Reported-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://postgr.es/m/1341064.1764895052@sss.pgh.pa.us",https://github.com/postgres/postgres/commit/7bc88c3d6f3af3af5330c0e209c8a3c411267d00
postgres/postgres,https://github.com/postgres/postgres,83f2f84,Michael Paquier,2025-12-05T00:21:13Z,"Show version of nodes in output of TAP tests  This commit adds the version information of a node initialized by Cluster.pm, that may vary depending on the install_path given by the test.  The code was written so as the node information, that includes the version number, was dumped before the version number was set.  This is particularly useful for the pg_upgrade TAP tests, that may mix several versions for cross-version runs.  The TAP infrastructure also allows mixing nodes with different versions, so this information can be useful for out-of-core tests.  Backpatch down to v15, where Cluster.pm and the pg_upgrade TAP tests have been introduced.  Author: Potapov Alexander <a.potapov@postgrespro.com> Reviewed-by: Daniel Gustafsson <daniel@yesql.se> Discussion: https://postgr.es/m/e59bb-692c0a80-5-6f987180@170377126 Backpatch-through: 15",https://github.com/postgres/postgres/commit/83f2f8413e8d9687fda7d5881c82b89b8d9d4043
postgres/postgres,https://github.com/postgres/postgres,904f9f5,Melanie Plageman,2025-12-04T23:55:02Z,"Suppress spurious Coverity warning in prune freeze logic  Adjust the prune_freeze_setup() parameter types of new_relfrozen_xid and new_relmin_mxid to prevent misleading Coverity analysis. heap_page_prune_and_freeze() compared these values against NULL when passing them to prune_freeze_setup(), causing Coverity to assume they could be NULL and flag a possible null-pointer dereference later, even though it occurs inside a directly related conditional.  Reported-by: Coverity Author: Melanie Plageman <melanieplageman@gmail.com>",https://github.com/postgres/postgres/commit/904f9f5ea0e00a88e2429682d01f2ec946bf553a
postgres/postgres,https://github.com/postgres/postgres,80f6e2f,Nathan Bossart,2025-12-04T21:42:18Z,"Fix key size of PrivateRefCountHash.  The key is the first member of PrivateRefCountEntry, which has type Buffer.  This commit changes the key size from sizeof(int32) to sizeof(Buffer).  This appears to be an oversight in commit 4b4b680c3d, but it's of no consequence because Buffer has been a signed 32-bit integer for a long time.  Author: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://postgr.es/m/aS77DTpl0fOkIKSZ%40ip-10-97-1-34.eu-west-3.compute.internal",https://github.com/postgres/postgres/commit/80f6e2fb4addb03e2e163a380b5e6e1f4b321286
postgres/postgres,https://github.com/postgres/postgres,e158fd4,Peter Eisentraut,2025-12-04T19:44:52Z,"Remove no longer needed casts from Pointer  These casts used to be required when Pointer was char *, but now it's void * (commit 1b2bb5077e9), so they are not needed anymore.  Author: Dagfinn Ilmari Mannsåker <ilmari@ilmari.org> Discussion: https://www.postgresql.org/message-id/4154950a-47ae-4223-bd01-1235cc50e933%40eisentraut.org",https://github.com/postgres/postgres/commit/e158fd4d68f44d0872c1d2053067fe306cc9d2b2
postgres/postgres,https://github.com/postgres/postgres,c6be3da,Peter Eisentraut,2025-12-04T18:40:08Z,"Remove no longer needed casts to Pointer  These casts used to be required when Pointer was char *, but now it's void * (commit 1b2bb5077e9), so they are not needed anymore.  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://www.postgresql.org/message-id/4154950a-47ae-4223-bd01-1235cc50e933%40eisentraut.org",https://github.com/postgres/postgres/commit/c6be3daa054a2fac67331f3bfc348b9bfd6f690c
postgres/postgres,https://github.com/postgres/postgres,6bd469d,Álvaro Herrera,2025-12-04T17:12:08Z,"amcheck: Fix snapshot usage in bt_index_parent_check  We were using SnapshotAny to do some index checks, but that's wrong and causes spurious errors when used on indexes created by CREATE INDEX CONCURRENTLY.  Fix it to use an MVCC snapshot, and add a test for it.  This problem came in with commit 5ae2087202af, which introduced uniqueness check.  Backpatch to 17.  Author: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Reviewed-by: Andrey Borodin <x4mmm@yandex-team.ru> Backpatch-through: 17 Discussion: https://postgr.es/m/CANtu0ojmVd27fEhfpST7RG2KZvwkX=dMyKUqg0KM87FkOSdz8Q@mail.gmail.com",https://github.com/postgres/postgres/commit/6bd469d26aca6ea413b35bfcb611dfa3a8f5ea45
postgres/postgres,https://github.com/postgres/postgres,40bdd83,Peter Eisentraut,2025-12-04T10:23:23Z,"headerscheck ccache support  Currently, headerscheck and cpluspluscheck are very slow, and they defeat use of ccache.  This fixes that, and now they are much faster.  The problem was that the test files are created in a randomly-named directory (`mktemp -d /tmp/$me.XXXXXX`), and this directory is mentioned on the compiler command line, which is part of the cache key.  The solution is to create the test files in the build directory.  For example, for src/include/storage/ipc.h, we generate      tmp_headerscheck_c/src_include_storage_ipc_h.c (or .cpp)  Now ccache works.  (And it's also a bit easier to debug everything with this naming.)  (The subdirectory is used to keep the cleanup trap simple.)  The observed speedup on Cirrus CI for headerscheck plus cpluspluscheck is from about 1min 20s to only 20s.  In local use, the speedups are similar.  Co-authored-by: Thomas Munro <thomas.munro@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Reviewed-by: Andres Freund <andres@anarazel.de> Discussion: https://www.postgresql.org/message-id/flat/b49e74d4-3cf9-4d1c-9dce-09f75e55d026%40eisentraut.org",https://github.com/postgres/postgres/commit/40bdd839f52a3e18a0e003f556cab3512510f633
postgres/postgres,https://github.com/postgres/postgres,d0b7a0b,Peter Eisentraut,2025-11-28T10:36:41Z,"headerscheck: Use LLVM_CPPFLAGS  Otherwise, headerscheck will fail if the LLVM headers are in a location not reached by the normal CFLAGS/CPPFLAGS.  Discussion: https://www.postgresql.org/message-id/flat/b49e74d4-3cf9-4d1c-9dce-09f75e55d026%40eisentraut.org",https://github.com/postgres/postgres/commit/d0b7a0b4c8f49ea96f171883d09e902483083d98
postgres/postgres,https://github.com/postgres/postgres,d6ef8ee,Alexander Korotkov,2025-12-04T08:38:12Z,"Fix incorrect assertion bound in WaitForLSN()  The assertion checking MyProcNumber used MaxBackends as the upper bound, but the procInfos array is allocated with size MaxBackends + NUM_AUXILIARY_PROCS. This inconsistency would cause a false assertion failure if an auxiliary process calls WaitForLSN().  Author: Xuneng Zhou <xunengzhou@gmail.com>",https://github.com/postgres/postgres/commit/d6ef8ee3ee29ffa404bcd920e02fb4b196e07b0d
postgres/postgres,https://github.com/postgres/postgres,6c5c393,Andres Freund,2025-12-03T23:38:20Z,"Rename BUFFERPIN wait event class to BUFFER  In an upcoming patch more wait events will be added to the wait event class (for buffer locking), making the current name too specific. Alternatively we could introduce a dedicated wait event class for those, but it seems somewhat confusing to have a BUFFERPIN and a BUFFER wait event class.  Reviewed-by: Melanie Plageman <melanieplageman@gmail.com> Discussion: https://postgr.es/m/fvfmkr5kk4nyex56ejgxj3uzi63isfxovp2biecb4bspbjrze7@az2pljabhnff",https://github.com/postgres/postgres/commit/6c5c393b74031351721f8a44e55bfaf6f249eefb
postgres/postgres,https://github.com/postgres/postgres,7902a47,Andres Freund,2025-12-03T23:38:20Z,"Add pg_atomic_unlocked_write_u64  The 64bit equivalent of pg_atomic_unlocked_write_u32(), to be used in an upcoming patch converting BufferDesc.state into a 64bit atomic.  Reviewed-by: Melanie Plageman <melanieplageman@gmail.com> Discussion: https://postgr.es/m/fvfmkr5kk4nyex56ejgxj3uzi63isfxovp2biecb4bspbjrze7@az2pljabhnff",https://github.com/postgres/postgres/commit/7902a47c20b1d5c0b7d20071f9ada6a0185bf39b
postgres/postgres,https://github.com/postgres/postgres,1566800,Andres Freund,2025-12-03T23:38:20Z,bufmgr: Turn BUFFER_LOCK_* into an enum  It seems cleaner to use an enum to tie the different values together. It also helps to have a more descriptive type in the argument to various functions.  Reviewed-by: Melanie Plageman <melanieplageman@gmail.com> Discussion: https://postgr.es/m/fvfmkr5kk4nyex56ejgxj3uzi63isfxovp2biecb4bspbjrze7@az2pljabhnff,https://github.com/postgres/postgres/commit/156680055dc523425f28ff5e61acf0f5bc99294b
postgres/postgres,https://github.com/postgres/postgres,8d61228,Tom Lane,2025-12-03T18:23:45Z,"Make stats_ext test faster under cache-clobbering test conditions.  Commit 1eccb9315 added a test case that will cause a large number of evaluations of a plpgsql function.  With -DCLOBBER_CACHE_ALWAYS, that takes an unreasonable amount of time (hours) because the function's cache entries are repeatedly deleted and rebuilt. That doesn't add any useful test coverage --- other test cases already exercise plpgsql well enough --- and it's not part of what this test intended to cover.  We can get the same planner coverage, if not more, by making the test directly invoke numeric_lt().  Reported-by: Tomas Vondra <tomas@vondra.me> Author: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://postgr.es/m/baf1ae02-83bd-4f5d-872a-1d04f11a9073@vondra.me",https://github.com/postgres/postgres/commit/8d61228717e619b90b8ebd1d219d006b920e00e5
postgres/postgres,https://github.com/postgres/postgres,7b81be9,Heikki Linnakangas,2025-12-03T17:39:34Z,Add test for multixid wraparound  Author: Andrey Borodin <amborodin@acm.org> Discussion: https://www.postgresql.org/message-id/7de697df-d74d-47db-9f73-e069b7349c4b@iki.fi,https://github.com/postgres/postgres/commit/7b81be9b42678c7ab69c3e8f565172f1d8d9e86f
postgres/postgres,https://github.com/postgres/postgres,789d653,Heikki Linnakangas,2025-12-03T17:15:08Z,"Set next multixid's offset when creating a new multixid  With this commit, the next multixid's offset will always be set on the offsets page, by the time that a backend might try to read it, so we no longer need the waiting mechanism with the condition variable. In other words, this eliminates ""corner case 2"" mentioned in the comments.  The waiting mechanism was broken in a few scenarios:  - When nextMulti was advanced without WAL-logging the next   multixid. For example, if a later multixid was already assigned and   WAL-logged before the previous one was WAL-logged, and then the   server crashed. In that case the next offset would never be set in   the offsets SLRU, and a query trying to read it would get stuck   waiting for it. Same thing could happen if pg_resetwal was used to   forcibly advance nextMulti.  - In hot standby mode, a deadlock could happen where one backend waits   for the next multixid assignment record, but WAL replay is not   advancing because of a recovery conflict with the waiting backend.  The old TAP test used carefully placed injection points to exercise the old waiting code, but now that the waiting code is gone, much of the old test is no longer relevant. Rewrite the test to reproduce the IPC/MultixactCreation hang after crash recovery instead, and to verify that previously recorded multixids stay readable.  Backpatch to all supported versions. In back-branches, we still need to be able to read WAL that was generated before this fix, so in the back-branches this includes a hack to initialize the next offsets page when replaying XLOG_MULTIXACT_CREATE_ID for the last multixid on a page. On 'master', bump XLOG_PAGE_MAGIC instead to indicate that the WAL is not compatible.  Author: Andrey Borodin <amborodin@acm.org> Reviewed-by: Dmitry Yurichev <dsy.075@yandex.ru> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Reviewed-by: Kirill Reshke <reshkekirill@gmail.com> Reviewed-by: Ivan Bykov <i.bykov@modernsys.ru> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://www.postgresql.org/message-id/172e5723-d65f-4eec-b512-14beacb326ce@yandex.ru Backpatch-through: 14",https://github.com/postgres/postgres/commit/789d65364cdecd81e4bf822eec468ea3d34d28af
postgres/postgres,https://github.com/postgres/postgres,9b05e2e,Nathan Bossart,2025-12-03T16:54:37Z,"Use ""foo(void)"" for definitions of functions with no parameters.  Standard practice in PostgreSQL is to use ""foo(void)"" instead of ""foo()"", as the latter looks like an ""old-style"" function declaration.  Similar changes were made in commits cdf4b9aff2, 0e72b9d440, 7069dbcc31, f1283ed6cc, 7b66e2c086, e95126cf04, and 9f7c527af3.  Author: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Reviewed-by: Matthias van de Meent <boekewurm+postgres@gmail.com> Discussion: https://postgr.es/m/aTBObQPg%2Bps5I7vl%40ip-10-97-1-34.eu-west-3.compute.internal",https://github.com/postgres/postgres/commit/9b05e2ec08a3d174accb2a9e1c59e52e94799acc
postgres/postgres,https://github.com/postgres/postgres,be25c77,Álvaro Herrera,2025-12-03T15:37:06Z,"Put back alternative-output expected files  These were removed in 5dee7a603f66, but that was too optimistic, per buildfarm member prion as reported by Tom Lane.  Mea (Álvaro's) culpa.  Author: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Discussion: https://postgr.es/m/570630.1764737028@sss.pgh.pa.us",https://github.com/postgres/postgres/commit/be25c77677285d3b1365bd19280b27771a1efbce
postgres/postgres,https://github.com/postgres/postgres,64527a1,Daniel Gustafsson,2025-12-03T14:22:38Z,"doc: Consistently use restartpoint in the documentation  The majority of cases already used ""restartpoint"" with just a few instances of ""restart point"". Changing the latter spelling to the former ensures consistency in the user facing documentation. Code comments are not affected by this since it is not worth the churn to change anything there.  Author: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Laurenz Albe <laurenz.albe@cybertec.at> Reviewed-by: Michael Paquier <michael@paquier.xyz> Discussion: https://postgr.es/m/0F6E38D0-649F-4489-B2C1-43CD937E6636@yesql.se",https://github.com/postgres/postgres/commit/64527a17a5053fdd52322dfe32a5a13e5d3f577c
postgres/postgres,https://github.com/postgres/postgres,9790aff,Peter Eisentraut,2025-12-03T13:41:12Z,Fix stray references to SubscriptRef  This type never existed.  SubscriptingRef was meant instead.  Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://www.postgresql.org/message-id/flat/2eaa45e3-efc5-4d75-b082-f8159f51445f%40eisentraut.org,https://github.com/postgres/postgres/commit/9790affcce032710c907aced834e968f2fc41bce
postgres/postgres,https://github.com/postgres/postgres,1b2bb50,Peter Eisentraut,2025-12-03T09:22:17Z,"Change Pointer to void *  The comment for the Pointer type said 'XXX Pointer arithmetic is done with this, so it can't be void * under ""true"" ANSI compilers.'.  This has been fixed in the previous commit 756a4368932.  This now changes the definition of the type from char * to void *, as envisaged by that comment.  Extension code that relies on using Pointer for pointer arithmetic will need to make changes similar to commit 756a4368932, but those changes would be backward compatible.  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://www.postgresql.org/message-id/4154950a-47ae-4223-bd01-1235cc50e933%40eisentraut.org",https://github.com/postgres/postgres/commit/1b2bb5077e9e9deac60a3e92e742465e7bcd3a21
postgres/postgres,https://github.com/postgres/postgres,756a436,Peter Eisentraut,2025-12-03T08:54:15Z,"Don't rely on pointer arithmetic with Pointer type  The comment for the Pointer type says 'XXX Pointer arithmetic is done with this, so it can't be void * under ""true"" ANSI compilers.'.  This fixes that.  Change from Pointer to use char * explicitly where pointer arithmetic is needed.  This makes the meaning of the code clearer locally and removes a dependency on the actual definition of the Pointer type.  (The definition of the Pointer type is not changed in this commit.)  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://www.postgresql.org/message-id/4154950a-47ae-4223-bd01-1235cc50e933%40eisentraut.org",https://github.com/postgres/postgres/commit/756a43689324b473ee07549a6eb7a53a203df5ad
postgres/postgres,https://github.com/postgres/postgres,8c6bbd6,Peter Eisentraut,2025-12-03T07:52:28Z,"Use more appropriate DatumGet* function  Use DatumGetCString() instead of DatumGetPointer() for returning a C string.  Right now, they are the same, but that doesn't always have to be so.  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://www.postgresql.org/message-id/4154950a-47ae-4223-bd01-1235cc50e933%40eisentraut.org",https://github.com/postgres/postgres/commit/8c6bbd674ed810df9af5ec42f6b38c205e3ad365
postgres/postgres,https://github.com/postgres/postgres,623801b,Peter Eisentraut,2025-12-03T07:40:33Z,Remove useless casts to Pointer  in arguments of memcpy() and memmove() calls  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://www.postgresql.org/message-id/4154950a-47ae-4223-bd01-1235cc50e933%40eisentraut.org,https://github.com/postgres/postgres/commit/623801b3bdb4e16df39f945b6aa5f109744c7b6b
postgres/postgres,https://github.com/postgres/postgres,c252d37,Amit Kapila,2025-12-03T03:31:31Z,Fix shadow variable warning in subscriptioncmds.c.  Author: Shlok Kyal <shlok.kyal.oss@gmail.com> Author: Peter Smith <smithpb2250@gmail.com> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Vignesh C <vignesh21@gmail.com> Discussion: https://postgr.es/m/CAHut+PsF8R0Bt4J3c92+T2F0mun0rRfK=-GH+iBv2s-O8ahJJw@mail.gmail.com,https://github.com/postgres/postgres/commit/c252d37d8ca8f254fa715ec24fcb23a035a88993
postgres/postgres,https://github.com/postgres/postgres,a6d05c8,Nathan Bossart,2025-12-02T22:40:23Z,Use LW_SHARED in dsa.c where possible.  Both dsa_get_total_size() and dsa_get_total_size_from_handle() take an exclusive lock just to read a variable.  This commit reduces the lock level to LW_SHARED in those functions.  Reviewed-by: Sami Imseih <samimseih@gmail.com> Discussion: https://postgr.es/m/aS8fMzWs9e8iHxk2%40nathan,https://github.com/postgres/postgres/commit/a6d05c819380b0940fcfb428aa298f2d7e76e5c6
postgres/postgres,https://github.com/postgres/postgres,cbe04e5,Heikki Linnakangas,2025-12-02T19:11:15Z,"Fix amcheck's handling of half-dead B-tree pages  amcheck incorrectly reported the following error if there were any half-dead pages in the index:  ERROR:  mismatch between parent key and child high key in index ""amchecktest_id_idx""  It's expected that a half-dead page does not have a downlink in the parent level, so skip the test.  Reported-by: Konstantin Knizhnik <knizhnik@garret.ru> Reviewed-by: Peter Geoghegan <pg@bowt.ie> Reviewed-by: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Discussion: https://www.postgresql.org/message-id/33e39552-6a2a-46f3-8b34-3f9f8004451f@garret.ru Backpatch-through: 14",https://github.com/postgres/postgres/commit/cbe04e5d729f292bcf9b06f5d774884b4511b18a
postgres/postgres,https://github.com/postgres/postgres,c085aab,Heikki Linnakangas,2025-12-02T19:11:05Z,"Add a test for half-dead pages in B-tree indexes  To increase our test coverage in general, and because I will use this in the next commit to test a bug we currently have in amcheck.  Reviewed-by: Peter Geoghegan <pg@bowt.ie> Discussion: https://www.postgresql.org/message-id/33e39552-6a2a-46f3-8b34-3f9f8004451f@garret.ru",https://github.com/postgres/postgres/commit/c085aab2781989f487364fab2978d9ee791559a4
postgres/postgres,https://github.com/postgres/postgres,6c05ef5,Heikki Linnakangas,2025-12-02T19:10:51Z,"Fix amcheck's handling of incomplete root splits in B-tree  When the root page is being split, it's normal that root page according to the metapage is not marked BTP_ROOT. Fix bogus error in amcheck about that case.  Reviewed-by: Peter Geoghegan <pg@bowt.ie> Discussion: https://www.postgresql.org/message-id/abd65090-5336-42cc-b768-2bdd66738404@iki.fi Backpatch-through: 14",https://github.com/postgres/postgres/commit/6c05ef5729c04d47400660cd994305bc44a3c757
postgres/postgres,https://github.com/postgres/postgres,1e4e578,Heikki Linnakangas,2025-12-02T19:10:47Z,"Add a test for incomplete splits in B-tree indexes  To increase our test coverage in general, and because I will add onto this in the next commit to also test amcheck with incomplete splits.  This is copied from the similar test we had for GIN indexes. B-tree's incomplete splits work similarly to GIN's, so with small changes, the same test works for B-tree too.  Reviewed-by: Peter Geoghegan <pg@bowt.ie> Discussion: https://www.postgresql.org/message-id/abd65090-5336-42cc-b768-2bdd66738404@iki.fi",https://github.com/postgres/postgres/commit/1e4e5783e7d77adb283ae7fa1ac99b0910a041b2
postgres/postgres,https://github.com/postgres/postgres,f894acb,Nathan Bossart,2025-12-02T16:29:45Z,"Show size of DSAs and dshashes in pg_dsm_registry_allocations.  Presently, this view reports NULL for the size of DSAs and dshash tables because 1) the current backend might not be attached to them and 2) the registry doesn't save the pointers to the dsa_area or dshash_table in local memory.  Also, the view doesn't show partially-initialized entries to avoid ambiguity, since those entries would report a NULL size as well.  This commit introduces a function that looks up the size of a DSA given its handle (transiently attaching to the control segment if needed) and teaches pg_dsm_registry_allocations to use it to show the size of successfully-initialized DSA and dshash entries. Furthermore, the view now reports partially-initialized entries with a NULL size.  Reviewed-by: Rahila Syed <rahilasyed90@gmail.com> Reviewed-by: Robert Haas <robertmhaas@gmail.com> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://postgr.es/m/aSeEDeznAsHR1_YF%40nathan",https://github.com/postgres/postgres/commit/f894acb24a12cf1f369a45af36c8f4049f9af571
postgres/postgres,https://github.com/postgres/postgres,7584792,Álvaro Herrera,2025-12-02T15:47:18Z,"Remove doc and code comments about ON CONFLICT deficiencies  They have been fixed, so we don't need this text anymore.  This reverts commit 8b18ed6dfbb8.  Author: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Discussion: https://postgr.es/m/CADzfLwWo+FV9WSeOah9F1r=4haa6eay1hNvYYy_WfziJeK+aLQ@mail.gmail.com",https://github.com/postgres/postgres/commit/758479213d574d6e2fbbdfee5328edef3d60da61
postgres/postgres,https://github.com/postgres/postgres,5dee7a6,Álvaro Herrera,2025-12-02T15:43:27Z,"Avoid use of NOTICE to wait for snapshot invalidation  This idea (implemented in commits and bc32a12e0db2 and 9e8fa05d3412) of using notices to detect that a session is sleeping was unreliable, so simplify the concurrency controller session to just look at pg_stat_activity for a process sleeping on the injection point we want it to hit.  This change allows us to remove a secondary injection point and the alternative expected output files.  Reproduced by Alexander Lakhin following a report in buildfarm member skink (which runs the server under valgrind).  Author: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Reported-by: Alexander Lakhin <exclusion@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://postgr.es/m/3e302c96-cdd2-45ec-af84-03dbcdccde4a@gmail.com",https://github.com/postgres/postgres/commit/5dee7a603f664115f8fe9819b0c19abd8209cd02
postgres/postgres,https://github.com/postgres/postgres,90eae92,Álvaro Herrera,2025-12-02T12:51:19Z,"Fix ON CONFLICT with REINDEX CONCURRENTLY and partitions  When planning queries with ON CONFLICT on partitioned tables, the indexes to consider as arbiters for each partition are determined based on those found in the parent table.  However, it's possible for an index on a partition to be reindexed, and in that case, the auxiliary indexes created on the partition must be considered as arbiters as well; failing to do that may result in spurious ""duplicate key"" errors given sufficient bad luck.  We fix that in this commit by matching every index that doesn't have a parent to each initially-determined arbiter index.  Every unparented matching index is considered an additional arbiter index.  Closely related to the fixes in bc32a12e0db2 and 2bc7e886fc1b, and for identical reasons, not backpatched (for now) even though it's a longstanding issue.  Author: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://postgr.es/m/CANtu0ojXmqjmEzp-=aJSxjsdE76iAsRgHBoK0QtYHimb_mEfsg@mail.gmail.com",https://github.com/postgres/postgres/commit/90eae926abbbcedbbea2ad5302722185e8652dca
postgres/postgres,https://github.com/postgres/postgres,4f941d4,Peter Eisentraut,2025-12-02T09:05:12Z,"Remove useless casting to same type  This removes some casts where the input already has the same type as the type specified by the cast.  Their presence could cause risks of hiding actual type mismatches in the future or silently discarding qualifiers.  It also improves readability.  Same kind of idea as 7f798aca1d5 and ef8fe693606.  (This does not change all such instances, but only those hand-picked by the author.)  Author: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Reviewed-by: Nathan Bossart <nathandbossart@gmail.com> Reviewed-by: Jacob Champion <jacob.champion@enterprisedb.com> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Discussion: https://www.postgresql.org/message-id/flat/aSQy2JawavlVlEB0%40ip-10-97-1-34.eu-west-3.compute.internal",https://github.com/postgres/postgres/commit/4f941d432b42eccd99ba0d22e3a59c073ac2406a
postgres/postgres,https://github.com/postgres/postgres,35988b3,Peter Eisentraut,2025-12-02T08:10:02Z,"Simplify hash_xlog_split_allocate_page()  Instead of complicated pointer arithmetic, overlay a uint32 array and just access the array members.  That's safe thanks to XLogRecGetBlockData() returning a MAXALIGNed buffer.  Reviewed-by: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Reviewed-by: Jacob Champion <jacob.champion@enterprisedb.com> Discussion: https://www.postgresql.org/message-id/flat/aSQy2JawavlVlEB0%40ip-10-97-1-34.eu-west-3.compute.internal",https://github.com/postgres/postgres/commit/35988b31db7767ba446009611b9928add1d40f98
postgres/postgres,https://github.com/postgres/postgres,ec782f5,Peter Eisentraut,2025-12-02T07:39:24Z,"Replace pointer comparisons and assignments to literal zero with NULL  While 0 is technically correct, NULL is the semantically appropriate choice for pointers.  Author: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://www.postgresql.org/message-id/aS1AYnZmuRZ8g%2B5G%40ip-10-97-1-34.eu-west-3.compute.internal",https://github.com/postgres/postgres/commit/ec782f56b0c30ef493e8356b46e1131612f01d9f
postgres/postgres,https://github.com/postgres/postgres,376c649,Peter Eisentraut,2025-12-02T07:18:50Z,"Update comment related to C99  One could do more work here to eliminate the Windows difference described in the comment, but that can be a separate project.  The purpose of this change is to update comments that might confusingly indicate that C99 is not required.  Reviewed-by: Thomas Munro <thomas.munro@gmail.com> Discussion: https://www.postgresql.org/message-id/flat/170308e6-a7a3-4484-87b2-f960bb564afa%40eisentraut.org",https://github.com/postgres/postgres/commit/376c649634bb3fbfad79940f996e2fcb4c2ea6bf
postgres/postgres,https://github.com/postgres/postgres,713d9a8,Michael Paquier,2025-12-02T00:30:23Z,"Update some timestamp[tz] functions to use soft-error reporting  This commit updates two functions that convert ""timestamptz"" to ""timestamp"", and vice-versa, to use the soft error reporting rather than a their own logic to do the same.  These are now named as follows: - timestamp2timestamptz_safe() - timestamptz2timestamp_safe()  These functions were suffixed with ""_opt_overflow"", previously.  This shaves some code, as it is possible to detect how a timestamp[tz] overflowed based on the returned value rather than a custom state.  It is optionally possible for the callers of these functions to rely on the error generated internally by these functions, depending on the error context.  Similar work has been done in d03668ea0566 and 4246a977bad6.  Reviewed-by: Amul Sul <sulamul@gmail.com> Discussion: https://postgr.es/m/aS09YF2GmVXjAxbJ@paquier.xyz",https://github.com/postgres/postgres/commit/713d9a847e6409a2a722aed90975eef6d75dc701
postgres/postgres,https://github.com/postgres/postgres,19b9662,Jeff Davis,2025-12-01T19:06:17Z,"Make regex ""max_chr"" depend on encoding, not provider.  The regex mechanism scans through the first ""max_chr"" character values to cache character property ranges (isalpha, etc.). For single-byte encodings, there's no sense in scanning beyond UCHAR_MAX; but for UTF-8 it makes sense to cache higher code point values (though not all of them; only up to MAX_SIMPLE_CHR).  Prior to 5a38104b36, the logic about how many character values to scan was based on the pg_regex_strategy, which was dependent on the provider. Commit 5a38104b36 preserved that logic exactly, allowing different providers to define the ""max_chr"".  Now, change it to depend only on the encoding and whether ctype_is_c. For this specific calculation, distinguishing between providers creates more complexity than it's worth.  Discussion: https://postgr.es/m/450ceb6260cad30d7afdf155d991a9caafee7c0d.camel@j-davis.com Reviewed-by: Chao Li <li.evan.chao@gmail.com>",https://github.com/postgres/postgres/commit/19b966243c38196a33b033fb0c259dcf760c0d69
postgres/postgres,https://github.com/postgres/postgres,99cd889,Jeff Davis,2025-12-01T17:24:03Z,"Change some callers to use pg_ascii_toupper().  The input is ASCII anyway, so it's better to be clear that it's not locale-dependent.  Discussion: https://postgr.es/m/450ceb6260cad30d7afdf155d991a9caafee7c0d.camel@j-davis.com",https://github.com/postgres/postgres/commit/99cd8890becacf9d7059297c3d75cd388ad83ac0
postgres/postgres,https://github.com/postgres/postgres,2bc7e88,Álvaro Herrera,2025-12-01T16:34:13Z,"Fix ON CONFLICT ON CONSTRAINT during REINDEX CONCURRENTLY  When REINDEX CONCURRENTLY is processing the index that supports a constraint, there are periods during which multiple indexes match the constraint index's definition.  Those must all be included in the set of inferred index for INSERT ON CONFLICT, in order to avoid spurious ""duplicate key"" errors.  To fix, we set things up to match all indexes against attributes, expressions and predicates of the constraint index, then return all indexes that match those, rather than just the one constraint index. This is more onerous than before, where we would just test the named constraint for validity, but it's not more onerous than processing ""conventional"" inference (where a list of attribute names etc is given).  This is closely related to the misbehaviors fixed by bc32a12e0db2, for a different situation.  We're not backpatching this one for now either, for the same reasons.  Author: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://postgr.es/m/CANtu0ojXmqjmEzp-=aJSxjsdE76iAsRgHBoK0QtYHimb_mEfsg@mail.gmail.com",https://github.com/postgres/postgres/commit/2bc7e886fc1baaeee3987a141bff3ac490037d12
postgres/postgres,https://github.com/postgres/postgres,2fcc5a7,Peter Eisentraut,2025-12-01T15:34:19Z,"Fix a strict aliasing violation  This one is almost a textbook example of an aliasing violation, and it is straightforward to fix, so clean it up.  (The warning only shows up if you remove the -fno-strict-aliasing option.)  Also, move the code after the error checking.  Doesn't make a difference technically, but it seems strange to do actions before errors are checked.  Reported-by: Tatsuo Ishii <ishii@postgresql.org> Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://www.postgresql.org/message-id/flat/20240724.155525.366150353176322967.ishii%40postgresql.org",https://github.com/postgres/postgres/commit/2fcc5a715130fbe9fb6eadf338e3bfe560eb0cb5
postgres/postgres,https://github.com/postgres/postgres,a87987c,Michael Paquier,2025-12-01T07:21:41Z,"Move WAL sequence code into its own file  This split exists for most of the other RMGRs, and makes cleaner the separation between the WAL code, the redo code and the record description code (already in its own file) when it comes to the sequence RMGR.  The redo and masking routines are moved to a new file, sequence_xlog.c.  All the RMGR routines are now located in a new header, sequence_xlog.h.  This separation is useful for a different patch related to sequences that I have been working on, where it makes a refactoring of sequence.c easier if its RMGR routines and its core routines are split.  Reviewed-by: Heikki Linnakangas <hlinnaka@iki.fi> Reviewed-by: Kirill Reshke <reshkekirill@gmail.com> Discussion: https://postgr.es/m/aSfTxIWjiXkTKh1E@paquier.xyz",https://github.com/postgres/postgres/commit/a87987cafca683e9076c424f99bae117211a83a4
postgres/postgres,https://github.com/postgres/postgres,d03668e,Michael Paquier,2025-12-01T06:22:20Z,"Switch some date/timestamp functions to use the soft error reporting  This commit changes some functions related to the data types date and timestamp to use the soft error reporting rather than a custom boolean flag called ""overflow"", used to let the callers of these functions know if an overflow happens.  This results in the removal of some boilerplate code, as it is possible to rely on an error context rather than a custom state, with the possibility to use the error generated inside the functions updated here, if necessary.  These functions were suffixed with ""_opt_overflow"".  They are now renamed to use ""_safe"" as suffix.  This work is similar to 4246a977bad6.  Author: Amul Sul <sulamul@gmail.com> Reviewed-by: Amit Langote <amitlangote09@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Discussion: https://postgr.es/m/CAAJ_b95HEmFyzHZfsdPquSHeswcopk8MCG1Q_vn4tVkZ+xxofw@mail.gmail.com",https://github.com/postgres/postgres/commit/d03668ea0566b53522cf2628ab7aa630247640a4
postgres/postgres,https://github.com/postgres/postgres,5424f4d,David Rowley,2025-11-29T23:55:34Z,"Don't call simplify_aggref with a NULL PlannerInfo  42473b3b3 added prosupport infrastructure to allow simplification of Aggrefs during constant-folding.  In some cases the context->root that's given to eval_const_expressions_mutator() can be NULL.  42473b3b3 failed to take that into account, which could result in a crash.  To fix, add a check and only call simplify_aggref() when the PlannerInfo is set.  Author: David Rowley <dgrowleyml@gmail.com> Reported-by: Birler, Altan <altan.birler@tum.de> Discussion: https://postgr.es/m/132d4da23b844d5ab9e352d34096eab5@tum.de",https://github.com/postgres/postgres/commit/5424f4da9031ac4681ab002d20f021232070c96a
postgres/postgres,https://github.com/postgres/postgres,c902bd5,Peter Geoghegan,2025-11-29T21:41:51Z,"Update obsolete row compare preprocessing comments.  We have some limited ability to detect redundant and contradictory conditions involving an nbtree row comparison key following commits f09816a0 and bd3f59fd: we can do so in simple cases involving IS NULL and IS NOT NULL keys on a row compare key's first column.  We can likewise determine that a scan's qual is unsatisfiable given a row compare whose first subkey's arg is NULL.  Update obsolete comments that claimed that we merely copied row compares into the output key array ""without any editorialization"".  Also update another _bt_preprocess_keys header comment paragraph: add a parenthetical remark that points out that preprocessing will generate a skip array for the preceding example qual.  That will ultimate lead to preprocessing marking the example's lower-order y key required -- which is exactly what the example supposes cannot happen.  Keep the original comment, though, since it accurately describes the mechanical rules that determine which keys get marked required in the absence of skip arrays (which can occasionally still matter).  This fixes an oversight in commit 92fe23d9, which added the nbtree skip scan optimization.  Author: Peter Geoghegan <pg@bowt.ie> Backpatch-through: 18",https://github.com/postgres/postgres/commit/c902bd57af998b52bde98c87916190309639129e
postgres/postgres,https://github.com/postgres/postgres,3881561,Dean Rasheed,2025-11-29T12:28:59Z,"Avoid rewriting data-modifying CTEs more than once.  Formerly, when updating an auto-updatable view, or a relation with rules, if the original query had any data-modifying CTEs, the rewriter would rewrite those CTEs multiple times as RewriteQuery() recursed into the product queries. In most cases that was harmless, because RewriteQuery() is mostly idempotent. However, if the CTE involved updating an always-generated column, it would trigger an error because any subsequent rewrite would appear to be attempting to assign a non-default value to the always-generated column.  This could perhaps be fixed by attempting to make RewriteQuery() fully idempotent, but that looks quite tricky to achieve, and would probably be quite fragile, given that more generated-column-type features might be added in the future.  Instead, fix by arranging for RewriteQuery() to rewrite each CTE exactly once (by tracking the number of CTEs already rewritten as it recurses). This has the advantage of being simpler and more efficient, but it does make RewriteQuery() dependent on the order in which rewriteRuleAction() joins the CTE lists from the original query and the rule action, so care must be taken if that is ever changed.  Reported-by: Bernice Southey <bernice.southey@gmail.com> Author: Bernice Southey <bernice.southey@gmail.com> Author: Dean Rasheed <dean.a.rasheed@gmail.com> Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Reviewed-by: Kirill Reshke <reshkekirill@gmail.com> Discussion: https://postgr.es/m/CAEDh4nyD6MSH9bROhsOsuTqGAv_QceU_GDvN9WcHLtZTCYM1kA@mail.gmail.com Backpatch-through: 14",https://github.com/postgres/postgres/commit/3881561d7715647dbb4a5bc27f116504903daf1b
postgres/postgres,https://github.com/postgres/postgres,87c6f8b,Peter Eisentraut,2025-11-28T15:00:57Z,"Generate translator comments for GUC parameter descriptions  Automatically generate comments like      /* translator: GUC parameter ""client_min_messages"" short description */  in the generated guc_tables.inc.c.  This provides translators more context.  Reviewed-by: Pavlo Golub <pavlo.golub@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Reviewed-by: Stéphane Schildknecht <sas.postgresql@gmail.com> Discussion: https://www.postgresql.org/message-id/flat/1a89b3f0-e588-41ef-b712-aba766143cad%40eisentraut.org",https://github.com/postgres/postgres/commit/87c6f8b047d5b0790e6f8b8532f4adf58dc60f67
postgres/postgres,https://github.com/postgres/postgres,8b3e2c6,Peter Eisentraut,2025-11-28T06:53:12Z,"Fix pg_isblank()  There was a pg_isblank() function that claimed to be a replacement for the standard isblank() function, which was thought to be ""not very portable yet"".  We can now assume that it's portable (it's in C99).  But pg_isblank() actually diverged from the standard isblank() by also accepting '\r', while the standard one only accepts space and tab. This was added to support parsing pg_hba.conf under Windows.  But the hba parsing code now works completely differently and already handles line endings before we get to pg_isblank().  The other user of pg_isblank() is for ident protocol message parsing, which also handles '\r' separately.  So this behavior is now obsolete and confusing.  To improve clarity, I separated those concerns.  The ident parsing now gets its own function that hardcodes the whitespace characters mentioned by the relevant RFC.  pg_isblank() is now static in hba.c and is a wrapper around the standard isblank(), with some extra logic to ensure robust treatment of non-ASCII characters.  Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://www.postgresql.org/message-id/flat/170308e6-a7a3-4484-87b2-f960bb564afa%40eisentraut.org",https://github.com/postgres/postgres/commit/8b3e2c622a85208b94808c54d9b40b10b030d304
postgres/postgres,https://github.com/postgres/postgres,e68b6ad,Amit Kapila,2025-11-28T05:21:35Z,"Add slotsync_skip_reason column to pg_replication_slots view.  Introduce a new column, slotsync_skip_reason, in the pg_replication_slots view. This column records the reason why the last slot synchronization was skipped. It is primarily relevant for logical replication slots on standby servers where the 'synced' field is true. The value is NULL when synchronization succeeds.  Author: Shlok Kyal <shlok.kyal.oss@gmail.com> Reviewed-by: shveta malik <shveta.malik@gmail.com> Reviewed-by: Hayato Kuroda <kuroda.hayato@fujitsu.com> Reviewed-by: Ashutosh Sharma <ashu.coek88@gmail.com> Reviewed-by: Hou Zhijie <houzj.fnst@fujitsu.com> Reviewed-by: Amit Kapila <amit.kapila16@gmail.com> Discussion: https://postgr.es/m/CAE9k0PkhfKrTEAsGz4DjOhEj1nQ+hbQVfvWUxNacD38ibW3a1g@mail.gmail.com",https://github.com/postgres/postgres/commit/e68b6adad96d414fdf24e072fdb1d41fb4b8f0b7
postgres/postgres,https://github.com/postgres/postgres,9ccc049,Michael Paquier,2025-11-28T00:04:04Z,"pg_buffercache: Add pg_buffercache_mark_dirty{,_relation,_all}()  This commit introduces three new functions for marking shared buffers as dirty by using the functions introduced in 9660906dbd69: * pg_buffercache_mark_dirty() for one shared buffer. - pg_buffercache_mark_dirt_relation() for all the shared buffers in a relation. * pg_buffercache_mark_dirty_all() for all the shared buffers in pool.  The ""_all"" and ""_relation"" flavors are designed to address the inefficiency of repeatedly calling pg_buffercache_mark_dirty() for each individual buffer, which can be time-consuming when dealing with with large shared buffers pool.  These functions are intended as developer tools and are available only to superusers.  There is no need to bump the version of pg_buffercache, 4b203d499c61 having done this job in this release cycle.  Author: Nazir Bilal Yavuz <byavuz81@gmail.com> Reviewed-by: Andres Freund <andres@anarazel.de> Reviewed-by: Aidar Imamov <a.imamov@postgrespro.ru> Reviewed-by: Amit Kapila <amit.kapila16@gmail.com> Reviewed-by: Joseph Koshakow <koshy44@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Reviewed-by: Yuhang Qiu <iamqyh@gmail.com> Reviewed-by: Xuneng Zhou <xunengzhou@gmail.com> Discussion: https://postgr.es/m/CAN55FZ0h_YoSqqutxV6DES1RW8ig6wcA8CR9rJk358YRMxZFmw@mail.gmail.com",https://github.com/postgres/postgres/commit/9ccc049dfe655ca9927f7c62559ec32f4d1f94dd
postgres/postgres,https://github.com/postgres/postgres,d167c19,David Rowley,2025-11-27T23:40:50Z,"Fix possibly uninitialized HeapScanDesc.rs_startblock  The solution used in 0ca3b1697 to determine the Parallel TID Range Scan's start location was to modify the signature of table_block_parallelscan_startblock_init() to allow the startblock to be passed in as a parameter.  This allows the scan limits to be adjusted before that function is called so that the limits are picked up when the parallel scan starts.  The commit made it so the call to table_block_parallelscan_startblock_init uses the HeapScanDesc's rs_startblock to pass the startblock to the parallel scan.  That all works ok for Parallel TID Range scans as the HeapScanDesc rs_startblock gets set by heap_setscanlimits(), but for Parallel Seq Scans, initscan() does not initialize rs_startblock, and that results in passing an uninitialized value to table_block_parallelscan_startblock_init() as noted by the buildfarm member skink, running Valgrind.  To fix this issue, make it so initscan() sets the rs_startblock for parallel scans unless we're doing a rescan.  This makes it so table_block_parallelscan_startblock_init() will be called with the startblock set to InvalidBlockNumber, and that'll allow the syncscan code to find the correct start location (when enabled).  For Parallel TID Range Scans, this InvalidBlockNumber value will be overwritten in the call to heap_setscanlimits().  initscan() is a bit light on documentation on what's meant to get initialized where for parallel scans.  From what I can tell, it looks like it just didn't matter prior to 0ca3b1697 that rs_startblock was left uninitialized for parallel scans.  To address the light documentation, I've also added some comments to mention that the syncscan location for parallel scans is figured out in table_block_parallelscan_startblock_init. I've also taken the liberty to adjust the if/else if/else code in initscan() to make it clearer which parts apply to parallel scans and which parts are for the serial scans.  Author: David Rowley <dgrowleyml@gmail.com> Discussion: https://postgr.es/m/CAApHDvqALm+k7FyfdQdCw1yF_8HojvR61YRrNhwRQPE=zSmnQA@mail.gmail.com",https://github.com/postgres/postgres/commit/d167c19295da46be1998dd474841f94170e32597
postgres/postgres,https://github.com/postgres/postgres,c75bf57,Michael Paquier,2025-11-27T23:00:23Z,"doc: Add missing tags in pg_buffercache page  Issue noticed while looking at this area of the documentation, for a different patch.  This is a matter of style, so no backpatch is done.  Discussion: https://postgr.es/m/CAN55FZ0h_YoSqqutxV6DES1RW8ig6wcA8CR9rJk358YRMxZFmw@mail.gmail.com",https://github.com/postgres/postgres/commit/c75bf57a90e05bf35afa00e66986b9210833bdaf
postgres/postgres,https://github.com/postgres/postgres,9660906,Michael Paquier,2025-11-27T22:39:33Z,"Add routines for marking buffers dirty efficiently  This commit introduces new internal bufmgr routines for marking shared buffers as dirty: * MarkDirtyUnpinnedBuffer() * MarkDirtyRelUnpinnedBuffers() * MarkDirtyAllUnpinnedBuffers()  These functions provide an efficient mechanism to respectively mark one buffer, all the buffers of a relation, or the entire shared buffer pool as dirty, something that can be useful to force patterns for the checkpointer.  MarkDirtyUnpinnedBufferInternal(), an extra routine, is used by these three, to mark as dirty an unpinned buffer.  They are intended as developer tools to manipulate buffer dirtiness in bulk, and will be used in a follow-up commit.  Author: Nazir Bilal Yavuz <byavuz81@gmail.com> Reviewed-by: Andres Freund <andres@anarazel.de> Reviewed-by: Aidar Imamov <a.imamov@postgrespro.ru> Reviewed-by: Amit Kapila <amit.kapila16@gmail.com> Reviewed-by: Joseph Koshakow <koshy44@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Reviewed-by: Yuhang Qiu <iamqyh@gmail.com> Reviewed-by: Xuneng Zhou <xunengzhou@gmail.com> Discussion: https://postgr.es/m/CAN55FZ0h_YoSqqutxV6DES1RW8ig6wcA8CR9rJk358YRMxZFmw@mail.gmail.com",https://github.com/postgres/postgres/commit/9660906dbd696146da2c1d8bfdce26b1a2bed1c3
postgres/postgres,https://github.com/postgres/postgres,5528e8d,Tom Lane,2025-11-27T18:09:59Z,"Allow indexscans on partial hash indexes with implied quals.  Normally, if a WHERE clause is implied by the predicate of a partial index, we drop that clause from the set of quals used with the index, since it's redundant to test it if we're scanning that index. However, if it's a hash index (or any !amoptionalkey index), this could result in dropping all available quals for the index's first key, preventing us from generating an indexscan.  It's fair to question the practical usefulness of this case.  Since hash only supports equality quals, the situation could only arise if the index's predicate is ""WHERE indexkey = constant"", implying that the index contains only one hash value, which would make hash a really poor choice of index type.  However, perhaps there are other !amoptionalkey index AMs out there with which such cases are more plausible.  To fix, just don't filter the candidate indexquals this way if the index is !amoptionalkey.  That's a bit hokey because it may result in testing quals we didn't need to test, but to do it more accurately we'd have to redundantly identify which candidate quals are actually usable with the index, something we don't know at this early stage of planning.  Doesn't seem worth the effort.  Reported-by: Sergei Glukhov <s.glukhov@postgrespro.ru> Author: Tom Lane <tgl@sss.pgh.pa.us> Reviewed-by: David Rowley <dgrowleyml@gmail.com> Discussion: https://postgr.es/m/e200bf38-6b45-446a-83fd-48617211feff@postgrespro.ru Backpatch-through: 14",https://github.com/postgres/postgres/commit/5528e8d1046062698b7db179e4280817eaeb5f30
postgres/postgres,https://github.com/postgres/postgres,246ec4a,Fujii Masao,2025-11-27T14:29:57Z,"doc: Fix misleading synopsis for CREATE/ALTER PUBLICATION.  The documentation for CREATE/ALTER PUBLICATION previously showed:          [ ONLY ] table_name [ * ] [ ( column_name [, ... ] ) ] [ WHERE ( expression ) ] [, ... ]  to indicate that the table/column specification could be repeated. However, placing [, ... ] directly after a multi-part construct was misleading and made it unclear which portion was repeatable.  This commit introduces a new term, table_and_columns, to represent:          [ ONLY ] table_name [ * ] [ ( column_name [, ... ] ) ] [ WHERE ( expression ) ]  and updates the synopsis to use:          table_and_columns [, ... ]  which clearly identifies the repeatable element.  Backpatched to v15, where the misleading syntax was introduced.  Author: Peter Smith <smithpb2250@gmail.com> Reviewed-by: Chao Li <lic@highgo.com> Reviewed-by: Fujii Masao <masao.fujii@gmail.com> Discussion: https://postgr.es/m/CAHut+PtsyvYL3KmA6C8f0ZpXQ=7FEqQtETVy-BOF+cm9WPvfMQ@mail.gmail.com Backpatch-through: 15",https://github.com/postgres/postgres/commit/246ec4a51c16f27133a293f63aa8bc86ca4fe630
postgres/postgres,https://github.com/postgres/postgres,9e8fa05,Álvaro Herrera,2025-11-27T12:10:56Z,"Fix new test for CATCACHE_FORCE_RELEASE builds  Two of the isolation tests introduce by commit bc32a12e0db2 had a problem under CATCACHE_FORCE_RELEASE, as evidenced by buildfarm member prion.  An injection point is hit ahead of what the test spec expects, so a session goes to sleep and there's no one there to wait it up.  Fix in the simplest possible way, which is to conditionally wake the process up if it's waiting.  An alternative output file is necessary to cover both cases.  This suggests a couple of possible improvements to the injection points infrastructure: a conditional wakeup (doing nothing if no one is sleeping, as opposed to throwing an error), as well as a way to attach to a point in ""deactivated"" mode, activated later.  Author: Álvaro Herrera <alvherre@kurilemu.de> Reviewed-by: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Discussion: https://postgr.es/m/202511261817.fyixgtt3hqdr@alvherre.pgsql",https://github.com/postgres/postgres/commit/9e8fa05d3412d6adea453a8ec24d9a794498f4cf
postgres/postgres,https://github.com/postgres/postgres,e396a18,Daniel Gustafsson,2025-11-27T08:25:56Z,doc: Fix typo in pg_dump documentation  Reported-by: Erik Rijkers <er@xs4all.nl> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://postgr.es/m/7596672c-43e8-a030-0850-2dd09af98cac@xs4all.nl,https://github.com/postgres/postgres/commit/e396a18f32e1a174be2492a83e7a8bfce568e6ab
postgres/postgres,https://github.com/postgres/postgres,e7075a3,Peter Eisentraut,2025-11-27T06:39:25Z,"Use C11 alignas in pg_atomic_uint64 definitions  They were already using pg_attribute_aligned.  This replaces that with alignas and moves that into the required syntactic position.  This ends up making these three atomics implementations appear a bit more consistent, but shouldn't change anything otherwise.  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://www.postgresql.org/message-id/flat/46f05236-d4d4-4b4e-84d4-faa500f14691%40eisentraut.org",https://github.com/postgres/postgres/commit/e7075a3405cc831128a71e83b2e39d464aa67fe8
postgres/postgres,https://github.com/postgres/postgres,519fa04,Amit Langote,2025-11-27T01:43:29Z,"Fix error reporting for SQL/JSON path type mismatches  transformJsonFuncExpr() used exprType()/exprLocation() on the possibly coerced path expression, which could be NULL when coercion to jsonpath failed, leading to ""cache lookup failed for type 0"" errors.  Preserve the original expression node so that type and location in the ""must be of type jsonpath"" error are reported correctly. Add regression tests to cover these cases.  Reported-by: Jian He <jian.universality@gmail.com> Author: Jian He <jian.universality@gmail.com> Reviewed-by: Kirill Reshke <reshkekirill@gmail.com> Discussion: https://postgr.es/m/CACJufxHunVg81JMuNo8Yvv_hJD0DicgaVN2Wteu8aJbVJPBjZA@mail.gmail.com Backpatch-through: 17",https://github.com/postgres/postgres/commit/519fa0433b37701b357753a568080bee2c47d238
postgres/postgres,https://github.com/postgres/postgres,0ca3b16,David Rowley,2025-11-27T01:05:04Z,"Add parallelism support for TID Range Scans  In v14, bb437f995 added support for scanning for ranges of TIDs using a dedicated executor node for the purpose.  Here, we allow these scans to be parallelized.  The range of blocks to scan is divvied up similarly to how a Parallel Seq Scans does that, where 'chunks' of blocks are allocated to each worker and the size of those chunks is slowly reduced down to 1 block per worker by the time we're nearing the end of the scan.  Doing that means workers finish at roughly the same time.  Allowing TID Range Scans to be parallelized removes the dilemma from the planner as to whether a Parallel Seq Scan will cost less than a non-parallel TID Range Scan due to the CPU concurrency of the Seq Scan (disk costs are not divided by the number of workers).  It was possible the planner could choose the Parallel Seq Scan which would result in reading additional blocks during execution than the TID Scan would have. Allowing Parallel TID Range Scans removes the trade-off the planner makes when choosing between reduced CPU costs due to parallelism vs additional I/O from the Parallel Seq Scan due to it scanning blocks from outside of the required TID range.  There is also, of course, the traditional parallelism performance benefits to be gained as well, which likely doesn't need to be explained here.  Author: Cary Huang <cary.huang@highgo.ca> Author: David Rowley <dgrowleyml@gmail.com> Reviewed-by: Junwang Zhao <zhjwpku@gmail.com> Reviewed-by: Rafia Sabih <rafia.pghackers@gmail.com> Reviewed-by: Steven Niu <niushiji@gmail.com> Discussion: https://postgr.es/m/18f2c002a24.11bc2ab825151706.3749144144619388582@highgo.ca",https://github.com/postgres/postgres/commit/0ca3b16973a8bb1c185f56e65edcadc0d9d2c406
postgres/postgres,https://github.com/postgres/postgres,42473b3,David Rowley,2025-11-26T21:43:28Z,"Have the planner replace COUNT(ANY) with COUNT(*), when possible  This adds SupportRequestSimplifyAggref to allow pg_proc.prosupport functions to receive an Aggref and allow them to determine if there is a way that the Aggref call can be optimized.  Also added is a support function to allow transformation of COUNT(ANY) into COUNT(*).  This is possible to do when the given ""ANY"" cannot be NULL and also that there are no ORDER BY / DISTINCT clauses within the Aggref.  This is a useful transformation to do as it is common that people write COUNT(1), which until now has added unneeded overhead. When counting a NOT NULL column.  The overheads can be worse as that might mean deforming more of the tuple, which for large fact tables may be many columns in.  It may be possible to add prosupport functions for other aggregates.  We could consider if ORDER BY could be dropped for some calls, e.g. the ORDER BY is quite useless in MAX(c ORDER BY c).  There is a little bit of passing fallout from adjusting expr_is_nonnullable() to handle Const which results in a plan change in the aggregates.out regression test.  Previously, nothing was able to determine that ""One-Time Filter: (100 IS NOT NULL)"" was always true, therefore useless to include in the plan.  Author: David Rowley <dgrowleyml@gmail.com> Reviewed-by: Corey Huinker <corey.huinker@gmail.com> Reviewed-by: Matheus Alcantara <matheusssilv97@gmail.com> Discussion: https://postgr.es/m/CAApHDvqGcPTagXpKfH=CrmHBqALpziThJEDs_MrPqjKVeDF9wA@mail.gmail.com",https://github.com/postgres/postgres/commit/42473b3b31238b15cc3c030b4416b2ee79508d8c
postgres/postgres,https://github.com/postgres/postgres,dbdc717,Nathan Bossart,2025-11-26T21:12:25Z,"Teach DSM registry to retry entry initialization if needed.  If DSM registry entry initialization fails, backends could try to use an uninitialized DSM segment, DSA, or dshash table (since the entry is still added to the registry).  To fix, restructure the code so that the registry retries initialization as needed.  This commit also modifies pg_get_dsm_registry_allocations() to leave out partially-initialized entries, as they shouldn't have any allocated memory.  DSM registry entry initialization shouldn't fail often in practice, but retrying was deemed better than leaving entries in a permanently failed state (as was done by commit 1165a933aa, which has since been reverted).  Suggested-by: Robert Haas <robertmhaas@gmail.com> Reviewed-by: Robert Haas <robertmhaas@gmail.com> Discussion: https://postgr.es/m/E1vJHUk-006I7r-37%40gemulon.postgresql.org Backpatch-through: 17",https://github.com/postgres/postgres/commit/dbdc717ac6743074c3a55fc5c380638c91d24afd
postgres/postgres,https://github.com/postgres/postgres,1476028,Jeff Davis,2025-11-26T20:45:06Z,"Allow pg_locale_t APIs to work when ctype_is_c.  Previously, the caller needed to check ctype_is_c first for some routines and not others. Now, the APIs consistently work, and the caller can just check ctype_is_c for optimization purposes.  Discussion: https://postgr.es/m/450ceb6260cad30d7afdf155d991a9caafee7c0d.camel@j-davis.com Reviewed-by: Chao Li <li.evan.chao@gmail.com>",https://github.com/postgres/postgres/commit/147602822597204aa436415ebe295926b268ab5c
postgres/postgres,https://github.com/postgres/postgres,1cdb84b,Daniel Gustafsson,2025-11-26T19:43:09Z,"Check for correct version of perltidy  pgperltidy requires a particular version of perltidy, but the version wasn't checked like how pgindent checks the underlying indent binary. Fix by checking the version of perltidy and error out if an incorrect version is used.  Author: Daniel Gustafsson <daniel@yesql.se> Reported-by: Tom Lane <tgl@sss.pgh.pa.us> Reviewed-by: Dagfinn Ilmari Mannsåker <ilmari@ilmari.org> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Reviewed-by: Andrew Dunstan <andrew@dunslane.net> Discussion: https://postgr.es/m/1209850.1764092152@sss.pgh.pa.us",https://github.com/postgres/postgres/commit/1cdb84bb1bcd6de4abcb5b2137f57c6c7463f4ab
postgres/postgres,https://github.com/postgres/postgres,8d29905,Jeff Davis,2025-11-26T18:05:11Z,Add #define for UNICODE_CASEMAP_BUFSZ.  Useful for mapping a single codepoint at a time into a statically-allocated buffer.  Discussion: https://postgr.es/m/450ceb6260cad30d7afdf155d991a9caafee7c0d.camel@j-davis.com Reviewed-by: Chao Li <li.evan.chao@gmail.com>,https://github.com/postgres/postgres/commit/8d299052fe5858319fbd9be5f234026711bbc91b
postgres/postgres,https://github.com/postgres/postgres,ec4997a,Jeff Davis,2025-11-26T18:04:32Z,Inline pg_ascii_tolower() and pg_ascii_toupper().  Discussion: https://postgr.es/m/450ceb6260cad30d7afdf155d991a9caafee7c0d.camel@j-davis.com Reviewed-by: Chao Li <li.evan.chao@gmail.com>,https://github.com/postgres/postgres/commit/ec4997a9d733e91b614d0c2f3e6445cc2905fd16
postgres/postgres,https://github.com/postgres/postgres,2dd506b,Nathan Bossart,2025-11-26T17:37:21Z,"Revert ""Teach DSM registry to ERROR if attaching to an uninitialized entry.""  This reverts commit 1165a933aa (and the corresponding commits on the back-branches).  In a follow-up commit, we'll teach the registry to retry entry initialization instead of leaving it in a permanently failed state.  Reviewed-by: Robert Haas <robertmhaas@gmail.com> Discussion: https://postgr.es/m/E1vJHUk-006I7r-37%40gemulon.postgresql.org Backpatch-through: 17",https://github.com/postgres/postgres/commit/2dd506b859cfacf8afaae81256ddec8cca0c0d6f
postgres/postgres,https://github.com/postgres/postgres,e135e04,Melanie Plageman,2025-11-26T15:57:50Z,Split heap_page_prune_and_freeze() into helpers  Refactor the setup and planning phases of pruning and freezing into helpers. This streamlines heap_page_prune_and_freeze() and makes it more clear when the examination of tuples ends and page modifications begin.  No code change beyond what was required to extract the code into helper functions.  Author: Melanie Plageman <melanieplageman@gmail.com> Reviewed-by: Andres Freund <andres@anarazel.de> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://postgr.es/m/mhf4vkmh3j57zx7vuxp4jagtdzwhu3573pgfpmnjwqa6i6yj5y%40sy4ymcdtdklo,https://github.com/postgres/postgres/commit/e135e044572e88291343f45ce65b406ac963b0e7
postgres/postgres,https://github.com/postgres/postgres,9446f91,Nathan Bossart,2025-11-26T15:50:00Z,"Remove a few unused struct members.  Oversights in commits ab9e0e718a, f3049a603a, and 247ce06b88.  Author: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://postgr.es/m/aScUuBSawPWogUxs%40ip-10-97-1-34.eu-west-3.compute.internal",https://github.com/postgres/postgres/commit/9446f918ace9c407805ba7d0a73e8370070b12f9
postgres/postgres,https://github.com/postgres/postgres,348020c,Daniel Gustafsson,2025-11-26T13:24:34Z,"ssl: Add connection and reload tests for key passphrases  ssl_passphrase_command_supports_reload was not covered by the SSL testsuite,  and connection tests after unlocking secrets with the passphrase was also missing.  This adds test coverage for reloads of passphrase commands as well as connection attempts which tests the different codepaths for Windows and non-EXEC_BACKEND builds.  Author: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Discussion: https://postgr.es/m/5F301096-921A-427D-8EC1-EBAEC2A35082@yesql.se",https://github.com/postgres/postgres/commit/348020caa7beaa2e4b1bc10b1ea6eb2c97b894c0
postgres/postgres,https://github.com/postgres/postgres,b3fe098,Daniel Gustafsson,2025-11-26T13:24:27Z,"Add GUC to show EXEC_BACKEND state  There is no straightforward way to determine if a cluster is running in EXEC_BACKEND mode or not, which is useful for tests to know. This adds a GUC debug_exec_backend similar to debug_assertions which will be true when the server is running in EXEC_BACKEND mode.  Author: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Discussion: https://postgr.es/m/5F301096-921A-427D-8EC1-EBAEC2A35082@yesql.se",https://github.com/postgres/postgres/commit/b3fe098d330ff6a7c23019d66a600072b1d4664d
postgres/postgres,https://github.com/postgres/postgres,0f4f457,Daniel Gustafsson,2025-11-26T13:24:04Z,"doc: Clarify passphrase command reloading on Windows  When running on Windows (or EXEC_BACKEND) the SSL configuration will be reloaded on each backend start, so the passphrase command will be reloaded along with it.  This implies that passphrase command reload must be enabled on Windows for connections to work at all.  Document this since it wasn't mentioned explicitly, and will there add markup for parameter value to match the rest of the docs.  Backpatch to all supported versions.  Author: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Discussion: https://postgr.es/m/5F301096-921A-427D-8EC1-EBAEC2A35082@yesql.se Backpatch-through: 14",https://github.com/postgres/postgres/commit/0f4f45772c5a87ca2f228ee3bea36d313dca0b51
postgres/postgres,https://github.com/postgres/postgres,8fe4aef,Peter Eisentraut,2025-11-26T06:46:33Z,"Replace internal C function pg_hypot() by standard hypot()  The code comment said, ""It is expected that this routine will eventually be replaced with the C99 hypot() function."", so let's do that now.  This function is tested via the geometry regression test, so if it is faulty on any platform, it will show up there.  Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://www.postgresql.org/message-id/flat/170308e6-a7a3-4484-87b2-f960bb564afa%40eisentraut.org",https://github.com/postgres/postgres/commit/8fe4aef8297b9f6b27a8f9422f3fdef1f79bb189
postgres/postgres,https://github.com/postgres/postgres,47c7a7e,Jacob Champion,2025-11-26T04:32:52Z,"oauth_validator: Shorten JSON responses in test logs  Response padding from the oauth_validator abuse tests was adding a couple megabytes to the test logs. We don't need the buildfarm to hold onto that, and we don't need to read it when debugging; truncate it.  Reported-by: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://postgr.es/m/202511251218.zfs4nu2qnh2m%40alvherre.pgsql Backpatch-through: 18",https://github.com/postgres/postgres/commit/47c7a7ebc89eb6b8cf81c937885864f994784d38
postgres/postgres,https://github.com/postgres/postgres,e3e787c,Amit Kapila,2025-11-26T03:26:57Z,"Fix test failure caused by commit 76b78721ca.  The test failed because it assumed that a newly created logical replication slot could be synced to the standby by the slotsync worker. However, the presence of an existing physical slot caused the new logical slot to use a non-latest xmin. On the standby, the DDL had already been replayed, advancing xmin, which led to the slotsync worker failing to sync the lagging logical slot.  To resolve this, we moved the slot sync statistics tests to run after the tests that do not require the newly created slot to be sync-ready.  As per buildfarm.  Author: Hou Zhijie <houzj.fnst@fujitsu.com> Reviewed-by: Hayato Kuroda <kuroda.hayato@fujitsu.com> Reviewed-by: Amit Kapila <amit.kapila16@gmail.com> Discussion: https://postgr.es/m/OSCPR01MB14966FE0BFB6C212298BFFEDEF5D1A@OSCPR01MB14966.jpnprd01.prod.outlook.com",https://github.com/postgres/postgres/commit/e3e787ca023449127ac370e13a3887fe03eed0f4
postgres/postgres,https://github.com/postgres/postgres,e1405aa,Michael Paquier,2025-11-26T01:53:16Z,"Add input function for data type pg_dependencies  pg_dependencies is used as data type for the contents of dependencies extended statistics.  This new input function consumes the format that has been established by e76defbcf09e for the output function of pg_dependencies, enforcing some sanity checks for: - Checks for the input object, which should be a one-dimension array with correct attributes and values. - The key names: ""attributes"", ""dependency"", ""degree"".  All are required, other key names are blocked. - Value types for each key: ""attributes"" requires an array of integers, ""dependency"" an attribute number, ""degree"" a float. - List of attributes.  In this case, it is possible that some dependencies are not listed in the statistics data, as items with a degree of 0 are discarded when building the statistics.  This commit includes checks for simple scenarios, like duplicated attributes, or overlapping values between the list of ""attributes"" and the ""dependency"" value.  Even if the input function considers the input as valid, a value still needs to be cross-checked with the attributes defined in a statistics object at import. - Based on the discussion, the checks on the values are loose, as there is also an argument for potentially stats injection.  For example, ""degree"" should be defined in [0.0,1.0], but a check is not enforced.  This is required for a follow-up patch that aims to implement the import of extended statistics.  Some tests are added to check the code paths of the JSON parser checking the shape of the pg_dependencies inputs, with 91% of code coverage reached.  The tests are located in their own new test file, for clarity.  Author: Corey Huinker <corey.huinker@gmail.com> Reviewed-by: Jian He <jian.universality@gmail.com> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Reviewed-by: Yuefei Shi <shiyuefei1004@gmail.com> Discussion: https://postgr.es/m/CADkLM=dpz3KFnqP-dgJ-zvRvtjsa8UZv8wDAQdqho=qN3kX0Zg@mail.gmail.com",https://github.com/postgres/postgres/commit/e1405aa5e3acd55a77838b0b7944198735ffccdf
postgres/postgres,https://github.com/postgres/postgres,44eba8f,Michael Paquier,2025-11-26T01:13:18Z,"Add input function for data type pg_ndistinct  pg_ndistinct is used as data type for the contents of ndistinct extended statistics.  This new input function consumes the format that has been established by 1f927cce4498 for the output function of pg_ndistinct, enforcing some sanity checks for: - Checks for the input object, which should be a one-dimension array with correct attributes and values. - The key names: ""attributes"", ""ndistinct"".  Both are required, other key names are blocked. - Value types for each key: ""attributes"" requires an array of integers, and ""ndistinct"" an integer. - List of attributes.  Note that this enforces a check so as an attribute list has to be a subset of the longest attribute list found. This does not enforce that a full group of attribute sets exist, based on how the groups are generated when the ndistinct objects are generated, making the list of ndistinct items a bit loose.  Note a check would still be required at import to see if the attributes listed match with the attribute numbers set in the definition of a statistics object. - Based on the discussion, the checks on the values are loose, as there is also an argument for potentially stats injection.  The relation and attribute level stats follow the same line of argument for the values.  This is required for a follow-up patch that aims to implement the import of extended statistics.  Some tests are added to check the code paths of the JSON parser checking the shape of the pg_ndistinct inputs, with 90% of code coverage reached.  The tests are located in their own new test file, for clarity.  Author: Corey Huinker <corey.huinker@gmail.com> Reviewed-by: Jian He <jian.universality@gmail.com> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Reviewed-by: Yuefei Shi <shiyuefei1004@gmail.com> Discussion: https://postgr.es/m/CADkLM=dpz3KFnqP-dgJ-zvRvtjsa8UZv8wDAQdqho=qN3kX0Zg@mail.gmail.com",https://github.com/postgres/postgres/commit/44eba8f06e5568be35fa3d112ab781e931fe04ae
postgres/postgres,https://github.com/postgres/postgres,cd38b7e,Melanie Plageman,2025-11-25T21:39:56Z,"Assert that cutoffs are provided if freezing will be attempted  heap_page_prune_and_freeze() requires the caller to initialize PruneFreezeParams->cutoffs so that the function can correctly evaluate whether tuples should be frozen. This requirement previously existed only in comments and was easy to miss, especially after “cutoffs” was converted from a direct function parameter to a field of the newly introduced PruneFreezeParams struct (added in 1937ed70621). Adding an assert makes this requirement explicit and harder to violate.  Also, fix a minor typo while we're at it.  Author: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Melanie Plageman <melanieplageman@gmail.com> Discussion: https://postgr.es/m/0AC177F5-5E26-45EE-B273-357C51212AC5%40gmail.com",https://github.com/postgres/postgres/commit/cd38b7e77315c729ea1e52ca7b8bb0d7c20d2a3b
postgres/postgres,https://github.com/postgres/postgres,3b9c118,Jeff Davis,2025-11-25T19:38:45Z,Remove a useless length check.  Author: Chao Li <lic@highgo.com> Discussion: https://postgr.es/m/CAEoWx2mW0P8CByavV58zm3=eb2MQHaKOcDEF5B2UJYRyC2c3ig@mail.gmail.com,https://github.com/postgres/postgres/commit/3b9c118920580b97d0f6f618954876227a50a14a
postgres/postgres,https://github.com/postgres/postgres,33bb3dc,Álvaro Herrera,2025-11-25T18:08:36Z,"pg_dump tests: don't put dumps in stdout  This bloats the regression log files for no reason.  Backpatch to 18; no further only because it fails to apply cleanly. (It's just whitespace change that conflicts, but I don't think this warrants more effort than this.)  Discussion: https://postgr.es/m/202511251218.zfs4nu2qnh2m@alvherre.pgsql",https://github.com/postgres/postgres/commit/33bb3dc2d855c0d4472372f0eb7877725af67a39
postgres/postgres,https://github.com/postgres/postgres,417ac9c,Álvaro Herrera,2025-11-25T17:20:06Z,"Improve test case stability  Given unlucky timing, some of the new tests added by commit bc32a12e0db2 can fail spuriously.  We haven't seen such failures yet in buildfarm, but allegedly we can prevent them with this tweak.  While at it, remove an unused injection point I (Álvaro) added.  Author: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Discussion: https://postgr.es/m/CADzfLwUc=jtSUEaQCtyt8zTeOJ-gHZ8=w_KJsVjDOYSLqaY9Lg@mail.gmail.com Discussion: https://postgr.es/m/CADzfLwV5oQq-Vg_VmG_o4SdL6yHjDoNO4T4pMtgJLzYGmYf74g@mail.gmail.com",https://github.com/postgres/postgres/commit/417ac9c1eeebc5dd8186a9089055b8af43b2450e
postgres/postgres,https://github.com/postgres/postgres,7169c0b,Peter Eisentraut,2025-11-25T15:50:34Z,"gen_guc_tables.pl: Validate required GUC fields before code generation  Previously, gen_guc_tables.pl would emit ""Use of uninitialized value"" warnings if required fields were missing in guc_parameters.dat (for example, when an integer or real GUC omitted the 'max' value).  The resulting error messages were unclear and did not identify which GUC entry was problematic.  Add explicit validation of required fields depending on the parameter type, and fail with a clear and specific message such as:      guc_parameters.dat:1909: error: entry ""max_index_keys"" of type ""int"" is missing required field ""max""  No changes to generated guc_tables.c.  Author: Chao Li <lic@highgo.com> Reviewed-by: Dagfinn Ilmari Mannsåker <ilmari@ilmari.org> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Discussion: https://www.postgresql.org/message-id/flat/CAEoWx2%3DoP4LgHi771_OKhPPUS7B-CTqCs%3D%3DuQcNXWrwBoAm5Vg%40mail.gmail.com",https://github.com/postgres/postgres/commit/7169c0b96bb8929c939c8e96a52b42571085efe9
postgres/postgres,https://github.com/postgres/postgres,2256af4,Peter Eisentraut,2025-11-25T14:38:23Z,backend/nodes cleanup: Move loop variables definitions into for statement  Author: Chao Li (Evan) <lic@highgo.com> Discussion: https://www.postgresql.org/message-id/flat/CAEoWx2nP12qwAaiJutbn1Kw50atN6FbMJNQ4bh4%2BfP_Ay_u7Eg%40mail.gmail.com,https://github.com/postgres/postgres/commit/2256af4ba223e114d08208fd17a27cbce30cda9e
postgres/postgres,https://github.com/postgres/postgres,3df4df5,Amit Kapila,2025-11-25T08:49:46Z,"Fix a BF failure caused by commit 76b78721ca.  The issue occurred because the replication slot was not released in the slotsync worker when a slot synchronization cycle was skipped. This skip happened because the required WAL was not received and flushed on the standby server. As a result, in the next cycle, when attempting to acquire the slot, an assertion failure was triggered.  Author: Hou Zhijie <houzj.fnst@fujitsu.com> Discussion: https://postgr.es/m/CAA4eK1KMwYUYy=oAVHu9mam+vX50ixxfhO4_C=kgQC8VCQHEfw@mail.gmail.com",https://github.com/postgres/postgres/commit/3df4df53b06df2a2af56a77bf44cffa6393534fe
postgres/postgres,https://github.com/postgres/postgres,76b7872,Amit Kapila,2025-11-25T06:47:49Z,Add slotsync skip statistics.  This patch adds two new columns to the pg_stat_replication_slots view: slotsync_skip_count - the total number of times a slotsync operation was skipped. slotsync_skip_at - the timestamp of the most recent skip.  These additions provide better visibility into replication slot synchronization behavior.  A future patch will introduce the slotsync_skip_reason column in pg_replication_slots to capture the reason for skip.  Author: Shlok Kyal <shlok.kyal.oss@gmail.com> Reviewed-by: shveta malik <shveta.malik@gmail.com> Reviewed-by: Hayato Kuroda <kuroda.hayato@fujitsu.com> Reviewed-by: Ashutosh Sharma <ashu.coek88@gmail.com> Reviewed-by: Amit Kapila <amit.kapila16@gmail.com> Discussion: https://postgr.es/m/CAE9k0PkhfKrTEAsGz4DjOhEj1nQ+hbQVfvWUxNacD38ibW3a1g@mail.gmail.com,https://github.com/postgres/postgres/commit/76b78721ca49c16dfcbfbd2f4f87fcdb2db2bbb6
postgres/postgres,https://github.com/postgres/postgres,c581c9a,Peter Eisentraut,2025-11-25T05:26:49Z,"Remove obsolete comment  This comment should probably have been moved to pg_locale_libc.c in commit 66ac94cdc79 (2024), but upon closer examination it was already completely obsolete then.  The first part of the comment has been obsolete since commit 85feb77aa09 (2017), which required that the system provides the required wide-character functions.  The second part has been obsolete since commit e9931bfb751 (2024), which eliminated code paths depending on the global LC_CTYPE setting.  Discussion: https://www.postgresql.org/message-id/flat/170308e6-a7a3-4484-87b2-f960bb564afa%40eisentraut.org",https://github.com/postgres/postgres/commit/c581c9a7ac2af2c75567013f25125bd294d49ff2
postgres/postgres,https://github.com/postgres/postgres,ed823da,Michael Paquier,2025-11-25T01:55:40Z,"Rename routines for write/read of pgstats file  This commit renames write_chunk and read_chunk to respectively pgstat_write_chunk() and pgstat_read_chunk(), along with the *_s convenience macros.  These are made available for plug-ins, so as any code that decides to write and/or read stats data can rely on a single code path for this work.  Extracted from a larger patch by the same author.  Author: Sami Imseih <samimseih@gmail.com> Discussion: https://postgr.es/m/CAA5RZ0s9SDOu+Z6veoJCHWk+kDeTktAtC-KY9fQ9Z6BJdDUirQ@mail.gmail.com",https://github.com/postgres/postgres/commit/ed823da12891232a6542168a0a1b7d2d1c5f3e9a
postgres/postgres,https://github.com/postgres/postgres,81f7738,Andres Freund,2025-11-24T22:37:09Z,"lwlock: Fix, currently harmless, bug in LWLockWakeup()  Accidentally the code in LWLockWakeup() checked the list of to-be-woken up processes to see if LW_FLAG_HAS_WAITERS should be unset. That means that HAS_WAITERS would not get unset immediately, but only during the next, unnecessary, call to LWLockWakeup().  Luckily, as the code stands, this is just a small efficiency issue.  However, if there were (as in a patch of mine) a case in which LWLockWakeup() would not find any backend to wake, despite the wait list not being empty, we'd wrongly unset LW_FLAG_HAS_WAITERS, leading to potentially hanging.  While the consequences in the backbranches are limited, the code as-is confusing, and it is possible that there are workloads where the additional wait list lock acquisitions hurt, therefore backpatch.  Discussion: https://postgr.es/m/fvfmkr5kk4nyex56ejgxj3uzi63isfxovp2biecb4bspbjrze7@az2pljabhnff Backpatch-through: 14",https://github.com/postgres/postgres/commit/81f773895321ac69d3d71fe9d203e09d072f9c36
postgres/postgres,https://github.com/postgres/postgres,f81bf78,Jeff Davis,2025-11-24T22:55:09Z,"Avoid global LC_CTYPE dependency in pg_locale_libc.c.  Call tolower_l() directly instead of through pg_tolower(), because the latter depends on the global LC_CTYPE.  Discussion: https://postgr.es/m/8186b28a1a39e61a0d833a4c25a8909ebbbabd48.camel@j-davis.com",https://github.com/postgres/postgres/commit/f81bf78ce12b9fd3e50eb00dd875440007262ec4
postgres/postgres,https://github.com/postgres/postgres,698fa92,Tom Lane,2025-11-24T22:00:16Z,"Improve detection of implicitly-temporary views.  We've long had a practice of making views temporary by default if they reference any temporary tables.  However the implementation was pretty incomplete, in that it only searched for RangeTblEntry references to temp relations.  Uses of temporary types, regclass constants, etc were not detected even though the dependency mechanism considers them grounds for dropping the view.  Thus a view not believed to be temp could silently go away at session exit anyhow.  To improve matters, replace the ad-hoc isQueryUsingTempRelation() logic with use of the dependency-based infrastructure introduced by commit 572c40ba9.  This is complete by definition, and it's less code overall.  While we're at it, we can also extend the warning NOTICE (or ERROR in the case of a materialized view) to mention one of the temp objects motivating the classification of the view as temp, as was done for functions in 572c40ba9.  Author: Tom Lane <tgl@sss.pgh.pa.us> Reviewed-by: Jim Jones <jim.jones@uni-muenster.de> Discussion: https://postgr.es/m/19cf6ae1-04cd-422c-a760-d7e75fe6cba9@uni-muenster.de",https://github.com/postgres/postgres/commit/698fa924b11a4ff55ac83b340dbae1e6cee00e59
postgres/postgres,https://github.com/postgres/postgres,0664aa4,Jacob Champion,2025-11-24T18:01:30Z,"Reorganize pqcomm.h a bit  Group the PG_PROTOCOL() codes, add a comment to AuthRequest now that the AUTH_REQ codes live in a different header, and make some small adjustments to spacing and comment style for the sake of scannability.  Reviewed-by: Jelte Fennema-Nio <postgres@jeltef.nl> Reviewed-by: Heikki Linnakangas <hlinnaka@iki.fi> Discussion: https://postgr.es/m/CAOYmi%2B%3D6zg4oXXOQtifrVao_YKiujTDa3u6bxnU08r0FsSig4g%40mail.gmail.com",https://github.com/postgres/postgres/commit/0664aa4ff89a640e5c0362cdcfc6cfc3eb63a659
postgres/postgres,https://github.com/postgres/postgres,e2ceff1,Jacob Champion,2025-11-24T17:59:54Z,"postgres: Use pg_{add,mul}_size_overflow()  The backend implementations of add_size() and mul_size() can now make use of the APIs provided in common/int.h.  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Discussion: https://postgr.es/m/CAOYmi%2B%3D%2BpqUd2MUitvgW1pAJuXgG_TKCVc3_Ek7pe8z9nkf%2BAg%40mail.gmail.com",https://github.com/postgres/postgres/commit/e2ceff13d83a85c634dc358b8291c7ae301e95e1
postgres/postgres,https://github.com/postgres/postgres,8934f21,Jacob Champion,2025-11-24T17:59:38Z,"Add pg_add_size_overflow() and friends  Commit 600086f47 added (several bespoke copies of) size_t addition with overflow checks to libpq. Move this to common/int.h, along with its subtraction and multiplication counterparts.  pg_neg_size_overflow() is intentionally omitted; I'm not sure we should add SSIZE_MAX to win32_port.h for the sake of a function with no callers.  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Discussion: https://postgr.es/m/CAOYmi%2B%3D%2BpqUd2MUitvgW1pAJuXgG_TKCVc3_Ek7pe8z9nkf%2BAg%40mail.gmail.com",https://github.com/postgres/postgres/commit/8934f2136cd82333fd148954a13a8ab01f7bd7ef
postgres/postgres,https://github.com/postgres/postgres,f1881c7,Jacob Champion,2025-11-24T17:55:16Z,"Make some use of anonymous unions [libpq-oauth]  Make some use of anonymous unions, which are allowed as of C11, as examples and encouragement for future code, and to test compilers.  This commit changes the json_field struct.  Reviewed-by: Nathan Bossart <nathandbossart@gmail.com> Discussion: https://postgr.es/m/CAOYmi%2BnV25oC5uXFgWodydGrHkfWMDCLUcjbAreM3mNX%3DF2JWw%40mail.gmail.com",https://github.com/postgres/postgres/commit/f1881c7dd32cf5f429f6bd525b5cbacef3bb9c99
postgres/postgres,https://github.com/postgres/postgres,bc32a12,Álvaro Herrera,2025-11-24T16:03:10Z,"Fix infer_arbiter_index during concurrent index operations  Previously, we would only consider indexes marked indisvalid as usable for INSERT ON CONFLICT.  But that's problematic during CREATE INDEX CONCURRENTLY and REINDEX CONCURRENTLY, because concurrent transactions would end up with inconsistents lists of inferred indexes, leading to deadlocks and spurious errors about unique key violations (because two transactions are operating on different indexes for the speculative insertion tokens).  Change this function to return indexes even if invalid.  This fixes the spurious errors and deadlocks.  Because such indexes might not be complete, we still need uniqueness to be verified in a different way.  We do that by requiring that at least one index marked valid is part of the set of indexes returned.  It is that index that is going to help ensure that the inserted tuple is indeed unique.  This does not fix similar problems occurring with partitioned tables or with named constraints.  These problems will be fixed in follow-up commits.  We have no user report of this problem, even though it exists in all branches.  Because of that and given that the fix is somewhat tricky, I decided not to backpatch for now.  Author: Mihail Nikalayeu <mihailnikalayeu@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://postgr.es/m/CANtu0ogv+6wqRzPK241jik4U95s1pW3MCZ3rX5ZqbFdUysz7Qw@mail.gmail.com",https://github.com/postgres/postgres/commit/bc32a12e0db2df203a9cb2315461578e08568b9c
postgres/postgres,https://github.com/postgres/postgres,e429c3c,Michael Paquier,2025-11-24T10:33:51Z,"Move isolation test index-killtuples to src/test/modules/index/  index-killtuples test depends on the contrib modules btree_gin and btree_gist, which would not be installed in a temporary installation with an execution of the main isolation test suite like this one: make -C src/test/isolation/ check  src/test/isolation/ should not depend on contrib/, and EXTRA_INSTALL has no effect in this case as this test suite uses its own Makefile rules.  This commit moves index-killtuples into its new module, called ""index"", whose name looks like the best fit there can be as it depends on more than one index AM.  btree_gin and btree_gist are now pulled in the temporary installation with EXTRA_INSTALL.  The test is renamed to ""killtuples"", for simplicity.  Author: Nazir Bilal Yavuz <byavuz81@gmail.com> Suggested-by: Andres Freund <andres@anarazel.de> Suggested-by: Michael Paquier <michael@paquier.xyz> Discussion: https://postgr.es/m/aKJsWedftW7UX1WM@paquier.xyz",https://github.com/postgres/postgres/commit/e429c3cecb4ac55d997acea0f76c5f06d6cb0ab3
postgres/postgres,https://github.com/postgres/postgres,d4c0f91,Peter Eisentraut,2025-11-24T06:36:49Z,"C11 alignas instead of unions -- extended alignments  This replaces some uses of pg_attribute_aligned() with the standard alignas() for cases where extended alignment (larger than max_align_t) is required.  This patch stipulates that all supported compilers must support alignments up to PG_IO_ALIGN_SIZE, but that seems pretty likely.  We can then also desupport the case where direct I/O is disabled because pg_attribute_aligned is not supported.  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://www.postgresql.org/message-id/flat/46f05236-d4d4-4b4e-84d4-faa500f14691%40eisentraut.org",https://github.com/postgres/postgres/commit/d4c0f91f7d57066b9d62c0eccb2a913d40c14066
postgres/postgres,https://github.com/postgres/postgres,4b203d4,Michael Paquier,2025-11-24T05:29:15Z,"pg_buffercache: Add pg_buffercache_os_pages  ba2a3c2302f has added a way to check if a buffer is spread across multiple pages with some NUMA information, via a new view pg_buffercache_numa that depends on pg_buffercache_numa_pages(), a SQL function.  These can only be queried when support for libnuma exists, generating an error if not.  However, it can be useful to know how shared buffers and OS pages map when NUMA is not supported or not available.  This commit expands the capabilities around pg_buffercache_numa: - pg_buffercache_numa_pages() is refactored as an internal function, able to optionally process NUMA.  Its SQL definition prior to this commit is still around to ensure backward-compatibility with v1.6. - A SQL function called pg_buffercache_os_pages() is added, able to work with or without NUMA. - The view pg_buffercache_numa is redefined to use pg_buffercache_os_pages(). - A new view is added, called pg_buffercache_os_pages.  This ignores NUMA for its result processing, for a better efficiency.  The implementation is done so as there is no code duplication between the NUMA and non-NUMA views/functions, relying on one internal function that does the job for all of them.  The module is bumped to v1.7.  Author: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Reviewed-by: Mircea Cadariu <cadariu.mircea@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Discussion: https://postgr.es/m/Z/fFA2heH6lpSLlt@ip-10-97-1-34.eu-west-3.compute.internal",https://github.com/postgres/postgres/commit/4b203d499c610160e9867e6add2366780429344c
postgres/postgres,https://github.com/postgres/postgres,07d1dc3,David Rowley,2025-11-24T04:00:01Z,"Fix incorrect IndexOptInfo header comment  The comment incorrectly indicated that indexcollations[] stored collations for both key columns and INCLUDE columns, but in reality it only has elements for the key columns.  canreturn[] didn't get a mention, so add that while we're here.  Author: Junwang Zhao <zhjwpku@gmail.com> Reviewed-by: David Rowley <dgrowleyml@gmail.com> Discussion: https://postgr.es/m/CAEG8a3LwbZgMKOQ9CmZarX5DEipKivdHp5PZMOO-riL0w%3DL%3D4A%40mail.gmail.com Backpatch-through: 14",https://github.com/postgres/postgres/commit/07d1dc3aebe4391a2711e951c69df2bb56447f8a
postgres/postgres,https://github.com/postgres/postgres,572c40b,Tom Lane,2025-11-23T20:02:55Z,"Issue a NOTICE if a created function depends on any temp objects.  We don't have an official concept of temporary functions.  (You can make one explicitly in pg_temp, but then you have to explicitly schema-qualify it on every call.)  However, until now we were quite laissez-faire about whether a non-temporary function could depend on a temporary object, such as a temp table or view.  If one does, it will silently go away at end of session, due to the automatic DROP ... CASCADE on the session's temporary objects.  People have complained that that's surprising; however, we can't really forbid it because other people (including our own regression tests) rely on being able to do it.  Let's compromise by emitting a NOTICE at CREATE FUNCTION time.  This is somewhat comparable to our ancient practice of emitting a NOTICE when forcing a view to become temp because it depends on temp tables.  Along the way, refactor recordDependencyOnExpr() so that the dependencies of an expression can be combined with other dependencies, instead of being emitted separately and perhaps duplicatively.  We should probably make the implementation of temp-by-default views use the same infrastructure used here, but that's for another patch.  It's unclear whether there are any other object classes that deserve similar treatment.  Author: Jim Jones <jim.jones@uni-muenster.de> Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://postgr.es/m/19cf6ae1-04cd-422c-a760-d7e75fe6cba9@uni-muenster.de",https://github.com/postgres/postgres/commit/572c40ba94ef6350c8dd51539ac7d932c1d1a12a
postgres/postgres,https://github.com/postgres/postgres,81966c5,Fujii Masao,2025-11-23T14:03:53Z,"psql: Improve tab-completion for PREPARE.  This commit enhances tab-completion for PREPARE xx AS to also suggest MERGE INTO, VALUES, WITH, and TABLE.  Author: Haruna Miwa <miwa@sraoss.co.jp> Reviewed-by: Fujii Masao <masao.fujii@gmail.com> Discussion: https://postgr.es/m/TY7P286MB5466B859BD6C5BE64E961878F1CEA@TY7P286MB5466.JPNP286.PROD.OUTLOOK.COM",https://github.com/postgres/postgres/commit/81966c5458fb0a441c69b21f63d43f04cdb0d2d6
postgres/postgres,https://github.com/postgres/postgres,7d9043a,Michael Paquier,2025-11-23T04:37:42Z,"pg_buffercache: Remove unused fields from BufferCacheNumaRec  These fields have been added in commit ba2a3c2302f, and have never been used.  While on it, this commit moves a comment that was out of place, improving it.  Author: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://postgr.es/m/aSBOKX6pLJzumbmF@ip-10-97-1-34.eu-west-3.compute.internal",https://github.com/postgres/postgres/commit/7d9043aee803bf9bf3307ce5f45f3464ea288cb1
postgres/postgres,https://github.com/postgres/postgres,b140c8d,Tom Lane,2025-11-23T00:33:34Z,"Add SupportRequestInlineInFrom planner support request.  This request allows a support function to replace a function call appearing in FROM (typically a set-returning function) with an equivalent SELECT subquery.  The subquery will then be subject to the planner's usual optimizations, potentially allowing a much better plan to be generated.  While the planner has long done this automatically for simple SQL-language functions, it's now possible for extensions to do it for functions outside that group. Notably, this could be useful for functions that are presently implemented in PL/pgSQL and work by generating and then EXECUTE'ing a SQL query.  Author: Paul A Jungwirth <pj@illuminatedcomputing.com> Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://postgr.es/m/09de6afa-c33d-4d94-a5cb-afc6cea0d2bb@illuminatedcomputing.com",https://github.com/postgres/postgres/commit/b140c8d7a3f3a5de4e4cc4a0b52909aa13060d4c
postgres/postgres,https://github.com/postgres/postgres,c0bc9af,Bruce Momjian,2025-11-22T17:01:56Z,tools:  remove src/tools/codelines  This is a one-line script never gained general usage since being added in 2005.  Backpatch-through: master,https://github.com/postgres/postgres/commit/c0bc9af15197e3604a6ec205a7485de21b0b21af
postgres/postgres,https://github.com/postgres/postgres,5eed8ce,Peter Eisentraut,2025-11-22T08:40:00Z,"Add range_minus_multi and multirange_minus_multi functions  The existing range_minus function raises an exception when the range is ""split"", because then the result can't be represented by a single range. For example '[0,10)'::int4range - '[4,5)' would be '[0,4)' and '[5,10)'.  This commit adds new set-returning functions so that callers can get results even in the case of splits. There is no risk of an exception for multiranges, but a set-returning function lets us handle them the same way we handle ranges.  Both functions return zero results if the subtraction would give an empty range/multirange.  The main use-case for these functions is to implement UPDATE/DELETE FOR PORTION OF, which must compute the application-time of ""temporal leftovers"": the part of history in an updated/deleted row that was not changed. To preserve the untouched history, we will implicitly insert one record for each result returned by range/multirange_minus_multi. Using a set-returning function will also let us support user-defined types for application-time update/delete in the future.  Author: Paul A. Jungwirth <pj@illuminatedcomputing.com> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://www.postgresql.org/message-id/flat/ec498c3d-5f2b-48ec-b989-5561c8aa2024%40illuminatedcomputing.com",https://github.com/postgres/postgres/commit/5eed8ce50ce9df1067b95593dde9f4fc526dfc72
postgres/postgres,https://github.com/postgres/postgres,0dceba2,Thomas Munro,2025-11-22T07:51:16Z,"jit: Adjust AArch64-only code for LLVM 21.  LLVM 21 changed the arguments of RTDyldObjectLinkingLayer's constructor, breaking compilation with the backported SectionMemoryManager from commit 9044fc1d.  https://github.com/llvm/llvm-project/commit/cd585864c0bbbd74ed2a2b1ccc191eed4d1c8f90  Backpatch-through: 14 Author: Holger Hoffstätte <holger@applied-asynchrony.com> Reviewed-by: Anthonin Bonnefoy <anthonin.bonnefoy@datadoghq.com> Discussion: https://postgr.es/m/d25e6e4a-d1b4-84d3-2f8a-6c45b975f53d%40applied-asynchrony.com",https://github.com/postgres/postgres/commit/0dceba21d74f01e63aa690879b44808bbb74a9c3
postgres/postgres,https://github.com/postgres/postgres,51da766,Andrew Dunstan,2025-11-21T22:08:46Z,Add 'make check-tests' behavior to the meson based builds  There was no easy way to run specific tests in the meson based builds.  Author: Nazir Bilal Yavuz <byavuz81@gmail.com> Reviewed-by: Ashutosh Bapat <ashutosh.bapat.oss@gmail.com> Reviewed-by: Jian He <jian.universality@gmail.com> Discussion: postgr.es/m/CAExHW5tK-QqayUN0%2BN3MF5bjV6vLKDCkRuGwoDJwc7vGjwCygQ%40mail.gmail.com,https://github.com/postgres/postgres/commit/51da766494dcc84b6f8d793ecaa064363a9243c2
postgres/postgres,https://github.com/postgres/postgres,5136411,Peter Eisentraut,2025-11-21T16:36:25Z,Fix typo in documentation about application time  Author: Paul A. Jungwirth <pj@illuminatedcomputing.com>,https://github.com/postgres/postgres/commit/51364113d5a00e53f9447de1f7056c440e0892d5
postgres/postgres,https://github.com/postgres/postgres,ef8fe69,Peter Eisentraut,2025-11-21T15:49:40Z,Remove useless casts to (void *)  Their presence causes (small) risks of hiding actual type mismatches or silently discarding qualifiers.  Some have been missed in 7f798aca1d5 and some are new ones along the same lines.  Author: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://www.postgresql.org/message-id/flat/aR8Yv%2BuATLKbJCgI%40ip-10-97-1-34.eu-west-3.compute.internal,https://github.com/postgres/postgres/commit/ef8fe693606add7edb563e6c8a63c6ef608338c0
postgres/postgres,https://github.com/postgres/postgres,2aabaa5,Heikki Linnakangas,2025-11-21T13:03:11Z,"Use strtoi64() in pgbench, replacing its open-coded implementation  Makes the code a little simpler.  The old implementation accepted trailing whitespace, but that was unnecessary. Firstly, its sibling function for parsing decimals, strtodouble(), does not accept trailing whitespace. Secondly, none of the callers can pass a string with trailing whitespace to it.  In the passing, check specifically for ERANGE before printing the ""out of range"" error. On some systems, strtoul() and strtod() return EINVAL on an empty or all-spaces string, and ""invalid input syntax"" is more appropriate for that than ""out of range"". For the existing strtodouble() function this is purely academical because it's never called with errorOK==false, but let's be tidy. (Perhaps we should remove the dead codepaths altogether, but I'll leave that for another day.)  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Reviewed-by: Yuefei Shi <shiyuefei1004@gmail.com> Reviewed-by: Neil Chen <carpenter.nail.cz@gmail.com> Discussion: https://www.postgresql.org/message-id/861dd5bd-f2c9-4ff5-8aa0-f82bdb75ec1f@iki.fi",https://github.com/postgres/postgres/commit/2aabaa52dffdb78fbefaef95163881c15e18ef29
postgres/postgres,https://github.com/postgres/postgres,e6be843,Peter Eisentraut,2025-11-21T12:01:30Z,"Update timezone to C99  This reverts changes done in PostgreSQL over the upstream code to avoid relying on C99 <stdint.h> and <inttypes.h>.  In passing, there were a few other minor and cosmetic changes that I left in to improve alignment with upstream, including some C11 feature use (_Noreturn).  Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://www.postgresql.org/message-id/flat/9ad2749f-77ab-4ecb-a321-1ca915480b05%40eisentraut.org",https://github.com/postgres/postgres/commit/e6be84356bbbaf9f88b6a738e690d6fdff6fe483
postgres/postgres,https://github.com/postgres/postgres,97e04c7,Peter Eisentraut,2025-11-21T08:57:06Z,"C11 alignas instead of unions  This changes a few union members that only existed to ensure alignments and replaces them with the C11 alignas specifier.  This change only uses fundamental alignments (meaning approximately alignments of basic types), which all C11 compilers must support. There are opportunities for similar changes using extended alignments, for example in PGIOAlignedBlock, but these are not necessarily supported by all compilers, so they are kept as a separate change.  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://www.postgresql.org/message-id/flat/46f05236-d4d4-4b4e-84d4-faa500f14691%40eisentraut.org",https://github.com/postgres/postgres/commit/97e04c74bedb902327b89eb8a9e6aea01aabdad2
postgres/postgres,https://github.com/postgres/postgres,266543a,Masahiko Sawada,2025-11-20T22:50:27Z,"Use ""COPY table TO"" for partitioned tables in initial table synchronization.  Commit 4bea91f added support for ""COPY table TO"" with partitioned tables. This commit enhances initial table synchronization in logical replication to use ""COPY table TO"" for partitioned tables if possible, instead of ""COPY (SELECT ...) TO"" variant, improving performance.  Author: Ajin Cherian <itsajin@gmail.com> Discussion: https://postgr.es/m/CAFPTHDY=w+xmEof=yyjhbDzaLxhBkoBzKcksEofXcT6EcjMbtQ@mail.gmail.com",https://github.com/postgres/postgres/commit/266543a62055541ddefe4e66797e0e1e4aa8705a
postgres/postgres,https://github.com/postgres/postgres,1e14edc,Melanie Plageman,2025-11-20T22:36:40Z,Split PruneFreezeParams initializers to one field per line  This conforms more closely with the style of other struct initializers in the code base. Initializing multiple fields on a single line is unpopular in part because pgindent won't permit a space after the comma before the next field's period.  Author: Melanie Plageman <melanieplageman@gmail.com> Reported-by: Dagfinn Ilmari Mannsåker <ilmari@ilmari.org> Discussion: https://postgr.es/m/87see87fnq.fsf%40wibble.ilmari.org,https://github.com/postgres/postgres/commit/1e14edcea5e1a122d4bf76d30fc963715e4dfe5e
postgres/postgres,https://github.com/postgres/postgres,5d4dc11,Bruce Momjian,2025-11-20T20:23:39Z,"tools:  update tools/codelines to use ""git ls-files""  This generates a more accurate code count because 'make distclean' doesn't always remove build files.  Author: idea from David Rowley  Discussion: https://postgr.es/m/aR4hoOotVHB7TXo5@momjian.us  Backpatch-through: master",https://github.com/postgres/postgres/commit/5d4dc112c7c6c10be739d61e8be012f20e9fdbbf
postgres/postgres,https://github.com/postgres/postgres,65ec565,Melanie Plageman,2025-11-20T16:40:36Z,"Update PruneState.all_[visible|frozen] earlier in pruning  During pruning and freezing in phase I of vacuum, we delay clearing all_visible and all_frozen in the presence of dead items. This allows opportunistic freezing if the page would otherwise be fully frozen, since those dead items are later removed in vacuum phase III.  To move the VM update into the same WAL record that prunes and freezes tuples, we must know whether the page will be marked all-visible/all-frozen before emitting WAL. Previously we waited until after emitting WAL to update all_visible/all_frozen to their correct values.  The only barrier to updating these flags immediately after deciding whether to opportunistically freeze was that while emitting WAL for a record freezing tuples, we use the pre-corrected value of all_frozen to compute the snapshot conflict horizon. By determining the conflict horizon earlier, we can update the flags immediately after making the opportunistic freeze decision.  This is required to set the VM in the XLOG_HEAP2_PRUNE_VACUUM_SCAN record emitted by pruning and freezing.  Author: Melanie Plageman <melanieplageman@gmail.com> Reviewed-by: Kirill Reshke <reshkekirill@gmail.com> Discussion: https://postgr.es/m/flat/CAAKRu_ZMw6Npd_qm2KM%2BFwQ3cMOMx1Dh3VMhp8-V7SOLxdK9-g%40mail.gmail.com",https://github.com/postgres/postgres/commit/65ec565b19fc35e9b09edcba4aecac350334ce87
postgres/postgres,https://github.com/postgres/postgres,351d7e2,Melanie Plageman,2025-11-20T15:58:34Z,"Keep all_frozen updated in heap_page_prune_and_freeze  Previously, we relied on all_visible and all_frozen being used together to ensure that all_frozen was correct, but it is better to keep both fields updated.  Future changes will separate their usage, so we should not depend on all_visible for the validity of all_frozen.  Author: Melanie Plageman <melanieplageman@gmail.com> Reviewed-by: Kirill Reshke <reshkekirill@gmail.com> Discussion: https://postgr.es/m/flat/CAAKRu_ZMw6Npd_qm2KM%2BFwQ3cMOMx1Dh3VMhp8-V7SOLxdK9-g%40mail.gmail.com",https://github.com/postgres/postgres/commit/351d7e244183ee33400c19e4b52c5446eb29038c
postgres/postgres,https://github.com/postgres/postgres,1937ed7,Melanie Plageman,2025-11-20T15:30:43Z,"Refactor heap_page_prune_and_freeze() parameters into a struct  heap_page_prune_and_freeze() had accumulated an unwieldy number of input parameters and upcoming work to handle VM updates in this function will add even more.  Introduce a new PruneFreezeParams struct to group the function’s input parameters, improving readability and maintainability.  Author: Melanie Plageman <melanieplageman@gmail.com> Reviewed-by: Kirill Reshke <reshkekirill@gmail.com> Discussion: https://postgr.es/m/yn4zp35kkdsjx6wf47zcfmxgexxt4h2og47pvnw2x5ifyrs3qc%407uw6jyyxuyf7",https://github.com/postgres/postgres/commit/1937ed70621e203c99e651ce4430dd217743d150
postgres/postgres,https://github.com/postgres/postgres,fa0ffa2,Daniel Gustafsson,2025-11-20T14:04:41Z,doc: Assorted documentation improvements  A set of wording improvements and spelling fixes.  Author: Oleg Sibiryakov <o.sibiryakov@postgrespro.ru> Reviewed-by: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Discussion: https://postgr.es/m/e62bedb5-c26f-4d37-b4ed-ce9b55f1e980@postgrespro.ru,https://github.com/postgres/postgres/commit/fa0ffa28778fbf4056a77f7b76361d295a737df6
postgres/postgres,https://github.com/postgres/postgres,20bff3d,Daniel Gustafsson,2025-11-20T13:49:33Z,"doc: Document how to run a subset of regress tests  This patch was originally submitted a year ago, but never ended up getting committed. It was later brought up again on a recent thread on the same subject.  Original patch by Paul A Jungwirth with some wordsmithing by me based on the review from the original thread.  Author: Paul A. Jungwirth <pj@illuminatedcomputing.com> Reviewed-by: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Viktor Holmberg <v@viktorh.net> Reviewed-by: Nazir Bilal Yavuz <byavuz81@gmail.com> Discussion: https://postgr.es/m/CA+renyXB5jYG9r5-CaDc4g607EB398QwTk_efEXTzarrO8bPzw@mail.gmail.com Discussion: https://postgr.es/m/CACJufxHOcmeTkoh2CxFHKv9GRnp9sLVzN=LZhqTgvqT++PXZNQ@mail.gmail.com",https://github.com/postgres/postgres/commit/20bff3d7945ec23b44322232d608f5776a1f0e35
postgres/postgres,https://github.com/postgres/postgres,599336c,Tomas Vondra,2025-11-20T11:51:58Z,"Handle EPERM in pg_numa_init  When running in Docker, the container may not have privileges needed by get_mempolicy(). This is called by numa_available() in libnuma, but versions prior to 2.0.19 did not expect that. The numa_available() call seemingly succeeds, but then we get unexpected failures when trying to query status of pages:    postgres =# select * from pg_shmem_allocations_numa;   ERROR:  XX000: failed NUMA pages inquiry status: Operation not           permitted   LOCATION:  pg_get_shmem_allocations_numa, shmem.c:691  The best solution is to call get_mempolicy() first, and proceed to numa_available() only when it does not fail with EPERM. Otherwise we'd need to treat older libnuma versions as insufficient, which seems a bit too harsh, as this only affects containerized systems.  Fix by me, based on suggestions by Christoph. Backpatch to 18, where the NUMA functions were introduced.  Reported-by: Christoph Berg <myon@debian.org> Reviewed-by: Christoph Berg <myon@debian.org> Discussion: https://postgr.es/m/aPDZOxjrmEo_1JRG@msg.df7cb.de Backpatch-through: 18",https://github.com/postgres/postgres/commit/599336c64fc9ef75727ec3ba4684644dc23f8ddb
postgres/postgres,https://github.com/postgres/postgres,b5623cc,Peter Eisentraut,2025-11-20T06:47:48Z,"Remove obsolete cast  The upstream timezone code uses a bool variable as an array subscript. Back when PostgreSQL's bool was char, this would have caused a warning from gcc -Wchar-subscripts, which is included in -Wall.  But this has been obsolete since probably commit d26a810ebf9, but certainly since bool is now the C standard bool.  So we can remove this deviation from the upstream code, to make future code merges simpler.  Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://www.postgresql.org/message-id/flat/9ad2749f-77ab-4ecb-a321-1ca915480b05%40eisentraut.org",https://github.com/postgres/postgres/commit/b5623cc5e4197b59d37b869fbd92c1778be0438e
postgres/postgres,https://github.com/postgres/postgres,aaf0357,Fujii Masao,2025-11-20T00:18:51Z,"doc: Update pg_upgrade documentation to match recent description changes.  Commit 792353f7d52 updated the pg_dump and pg_dumpall documentation to clarify which statistics are not included in their output. The pg_upgrade documentation contained a nearly identical description, but it was not updated at the same time.  This commit updates the pg_upgrade documentation to match those changes.  Backpatch to v18, where commit 792353f7d52 was backpatched to.  Author: Fujii Masao <masao.fujii@gmail.com> Reviewed-by: Bruce Momjian <bruce@momjian.us> Discussion: https://postgr.es/m/CAHGQGwFnfgdGz8aGWVzgFCFwoWQU7KnFFjmxinf4RkQAkzmR+w@mail.gmail.com Backpatch-through: 18",https://github.com/postgres/postgres/commit/aaf035790aebb4de6d85b60f8f3089c3c656b325
postgres/postgres,https://github.com/postgres/postgres,99780da,Fujii Masao,2025-11-20T00:14:02Z,"Add HINT listing valid encodings to encode() and decode() errors.  This commit updates encode() and decode() so that when an invalid encoding is specified, their error message includes a HINT listing all valid encodings. This helps users quickly see which encodings are supported without needing to consult the documentation.  Author: Shinya Sugamoto <shinya34892@gmail.com> Reviewed-by: Chao Li <lic@highgo.com> Reviewed-by: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Masahiko Sawada <sawada.mshk@gmail.com> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Reviewed-by: Nathan Bossart <nathandbossart@gmail.com> Reviewed-by: Fujii Masao <masao.fujii@gmail.com> Discussion: https://postgr.es/m/CAAe3y+99sfPv8UDF1VM-rC1i5HBdqxUh=2HrbJJFm2+i=1OwOw@mail.gmail.com",https://github.com/postgres/postgres/commit/99780da7209605bf9f226eac3eac30ab2bc9427c
postgres/postgres,https://github.com/postgres/postgres,6b46669,Thomas Munro,2025-11-19T21:23:44Z,"Drop support for MSVCRT's float formatting quirk.  Commit f1885386 added code to remove an unnecessary leading zero from the exponent in a float formatted by the system snprintf().  The C standard doesn't allow unnecessary digits beyond two, and the tests pass without this on Windows' modern UCRT (required since commit 1758d424).  Discussion: https://postgr.es/m/CA%2BhUKGJnmzTqiODmTjf-23yZ%3DE3HXqFTtKoyp3TF-MpB93hTMQ%40mail.gmail.com",https://github.com/postgres/postgres/commit/6b46669883fac9521c20fe4e2c55ccfbee778591
postgres/postgres,https://github.com/postgres/postgres,7ab9b34,Thomas Munro,2025-11-19T21:04:11Z,"Drop support for MSVCRT's %I64 format strings.  MSVCRT predated C99 and invented non-standard placeholders for 64-bit numbers, and then later used them in standard macros when C99 <inttypes.h> arrived.  The macros just use %lld etc when building with UCRT, so there should be no way for our interposed sprintf.c code to receive the pre-standard kind these days.  Time to drop the code that parses them.  That code was in fact already dead when commit 962da900 landed, as we'd disclaimed MSVCRT support a couple of weeks earlier in commit 1758d424, but patch development overlapped and the history of these macros hadn't been investigated.  Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Discussion: https://postgr.es/m/4d8b1a67-aab2-4429-b44b-f03988095939%40eisentraut.org",https://github.com/postgres/postgres/commit/7ab9b34614c2d6f69070a667787e0b091ecb72b1
postgres/postgres,https://github.com/postgres/postgres,057012b,Tom Lane,2025-11-19T18:22:12Z,"Speed up eqjoinsel() with lots of MCV entries.  If both sides of the operator have most-common-value statistics, eqjoinsel wants to check which MCVs have matches on the other side. Formerly it did this with a dumb compare-all-the-entries loop, which had O(N^2) behavior for long MCV lists.  When that code was written, twenty-plus years ago, that seemed tolerable; but nowadays people frequently use much larger statistics targets, so that the O(N^2) behavior can hurt quite a bit.  To add insult to injury, when asked for semijoin semantics, the entire comparison loop was done over, even though we frequently know that it will yield exactly the same results.  To improve matters, switch to using a hash table to perform the matching.  Testing suggests that depending on the data type, we may need up to about 100 MCVs on each side to amortize the extra costs of setting up the hash table and performing hash-value computations; so continue to use the old looping method when there are fewer MCVs than that.  Also, refactor so that we don't repeat the matching work unless we really need to, which occurs only in the uncommon case where eqjoinsel_semi decides to truncate the set of inner MCVs it considers.  The refactoring also got rid of the need to use the presented operator's commutator.  Real-world operators that are using eqjoinsel should pretty much always have commutators, but at the very least this saves a few syscache lookups.  Author: Ilia Evdokimov <ilya.evdokimov@tantorlabs.com> Co-authored-by: David Geier <geidav.pg@gmail.com> Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://postgr.es/m/20ea8bf5-3569-4e46-92ef-ebb2666debf6@tantorlabs.com",https://github.com/postgres/postgres/commit/057012b205a082ec930cd7bb7f6663516be011e2
postgres/postgres,https://github.com/postgres/postgres,d5b4f3a,Heikki Linnakangas,2025-11-19T16:05:42Z,"Print new OldestXID value in pg_resetwal when it's being changed  Commit 74cf7d46a91d added the --oldest-transaction-id option to pg_resetwal, but forgot to update the code that prints all the new values that are being set. Fix that.  Reviewed-by: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://www.postgresql.org/message-id/5461bc85-e684-4531-b4d2-d2e57ad18cba@iki.fi Backpatch-through: 14",https://github.com/postgres/postgres/commit/d5b4f3a6d4e0c065562d1c0c69e7c4aba2623910
postgres/postgres,https://github.com/postgres/postgres,cbdce71,Nathan Bossart,2025-11-19T16:01:37Z,doc: Update formula for vacuum insert threshold.  Oversight in commit 06eae9e621.  Reviewed-by: Melanie Plageman <melanieplageman@gmail.com> Discussion: https://postgr.es/m/aRODeqFUVkGDJSPP%40nathan Backpatch-through: 18,https://github.com/postgres/postgres/commit/cbdce71b9984e9bb2d8b3a4a8de466cbb2c32ea7
postgres/postgres,https://github.com/postgres/postgres,86b276a,Peter Eisentraut,2025-11-19T09:41:28Z,Fix indentation  for commit 0fc33b00536,https://github.com/postgres/postgres/commit/86b276a4a9b4b2c63ef00765f0e2867e1bcac4ca
postgres/postgres,https://github.com/postgres/postgres,0fc33b0,Peter Eisentraut,2025-11-19T07:46:31Z,"Fix NLS for incorrect GUC enum value hint message  The translation markers were applied at the wrong place, so no string was extracted for translation.  Also add translator comments here and in a similar place.  Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://www.postgresql.org/message-id/2c961fa1-14f6-44a2-985c-e30b95654e8d%40eisentraut.org",https://github.com/postgres/postgres/commit/0fc33b00536cf395b44260b6fc76b6b1d6fc0bcb
postgres/postgres,https://github.com/postgres/postgres,300c8f5,Peter Eisentraut,2025-11-19T07:02:05Z,Add <stdalign.h> to c.h  This allows using the C11 constructs alignas and alignof (not done in this patch).  Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://www.postgresql.org/message-id/flat/46f05236-d4d4-4b4e-84d4-faa500f14691%40eisentraut.org,https://github.com/postgres/postgres/commit/300c8f532478a387cc772a9b985b9d7a4b4dd093
postgres/postgres,https://github.com/postgres/postgres,4d3f623,Richard Guo,2025-11-19T02:04:03Z,"Fix typo in nodeHash.c  Replace ""overlow"" with ""overflow"".  Author: Tender Wang <tndrwang@gmail.com> Discussion: https://postgr.es/m/CAHewXNnzFjAjYLTkP78HE2PQ17MjBqFdQQg+0X6Wo7YMUb68xA@mail.gmail.com",https://github.com/postgres/postgres/commit/4d3f623ea887a7b6e74d7567e3e0c4b66fd58e50
postgres/postgres,https://github.com/postgres/postgres,3e83bdd,Tom Lane,2025-11-18T21:16:46Z,"Fix pg_popcount_aarch64.c to build with ancient glibc releases.  Like commit 6d969ca68, except here we are mopping up after 519338ace. (There are no other uses of <sys/auxv.h> in the tree, so we should be done now.)  Reported-by: GaoZengqi <pgf00a@gmail.com> Author: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://postgr.es/m/CAFmBtr3Av62-jBzdhFkDHXJF9vQmNtSnH2upwODjnRcsgdTytw@mail.gmail.com Backpatch-through: 18",https://github.com/postgres/postgres/commit/3e83bdd35a5f38511b396a40f060cbc49b62e74d
postgres/postgres,https://github.com/postgres/postgres,77fb395,Álvaro Herrera,2025-11-18T18:31:23Z,Fix typo,https://github.com/postgres/postgres/commit/77fb3959a45d1a748cb28f3f58da18c6645b45d3
postgres/postgres,https://github.com/postgres/postgres,35b5c62,Tom Lane,2025-11-18T17:56:55Z,"Don't allow CTEs to determine semantic levels of aggregates.  The fix for bug #19055 (commit b0cc0a71e) allowed CTE references in sub-selects within aggregate functions to affect the semantic levels assigned to such aggregates.  It turns out this broke some related cases, leading to assertion failures or strange planner errors such as ""unexpected outer reference in CTE query"".  After experimenting with some alternative rules for assigning the semantic level in such cases, we've come to the conclusion that changing the level is more likely to break things than be helpful.  Therefore, this patch undoes what b0cc0a71e changed, and instead installs logic to throw an error if there is any reference to a CTE that's below the semantic level that standard SQL rules would assign to the aggregate based on its contained Var and Aggref nodes. (The SQL standard disallows sub-selects within aggregate functions, so it can't reach the troublesome case and hence has no rule for what to do.)  Perhaps someone will come along with a legitimate query that this logic rejects, and if so probably the example will help us craft a level-adjustment rule that works better than what b0cc0a71e did. I'm not holding my breath for that though, because the previous logic had been there for a very long time before bug #19055 without complaints, and that bug report sure looks to have originated from fuzzing not from real usage.  Like b0cc0a71e, back-patch to all supported branches, though sadly that no longer includes v13.  Bug: #19106 Reported-by: Kamil Monicz <kamil@monicz.dev> Author: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://postgr.es/m/19106-9dd3668a0734cd72@postgresql.org Backpatch-through: 14",https://github.com/postgres/postgres/commit/35b5c62c3ad9a28ca145691219d889c638c82e37
postgres/postgres,https://github.com/postgres/postgres,faf4128,Nathan Bossart,2025-11-18T16:32:22Z,Add commit f63ae72bbc to .git-blame-ignore-revs.,https://github.com/postgres/postgres/commit/faf4128ad36425045c1ffb48537d094253bba0ef
postgres/postgres,https://github.com/postgres/postgres,379f0e9,Nathan Bossart,2025-11-18T16:28:36Z,Check for tabs in postgresql.conf.sample.  The previous commit updated this file to use spaces instead of tabs.  This commit adds a test to ensure that no new tabs are added.  Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://postgr.es/m/aReNUKdMgKxLqmq7%40nathan,https://github.com/postgres/postgres/commit/379f0e9f72b3e2504641aaabc7db2b03c00b146b
postgres/postgres,https://github.com/postgres/postgres,f63ae72,Nathan Bossart,2025-11-18T16:28:36Z,"Switch from tabs to spaces in postgresql.conf.sample.  This file is written for 8-space tabs, since we expect that most users who edit their configuration files use 8-space tabs. However, most of PostgreSQL is written for 4-space tabs, and at least one popular web interface defaults to 4-space tabs.  Rather than trying to standardize on a particular tab width for this file, let's just switch to spaces.  Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://postgr.es/m/aReNUKdMgKxLqmq7%40nathan",https://github.com/postgres/postgres/commit/f63ae72bbcea057534144eaf27ffe3f6e9267511
postgres/postgres,https://github.com/postgres/postgres,aeebb49,Nathan Bossart,2025-11-18T16:28:36Z,Update .editorconfig and .gitattributes for postgresql.conf.sample.  This commit updates .editorconfig and .gitattributes in preparation for a follow-up commit that will modify this file to use spaces instead of tabs.  Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://postgr.es/m/aReNUKdMgKxLqmq7%40nathan,https://github.com/postgres/postgres/commit/aeebb49b7cfeff525fafe8ae105e091c923193fb
postgres/postgres,https://github.com/postgres/postgres,c05dee1,Álvaro Herrera,2025-11-18T15:13:29Z,Log a note at program start when running in dry-run mode  Users might get some peace of mind knowing their data is not being destroyed or whatever.  Author: Peter Smith <smithpb2250@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://postgr.es/m/CAHut+PsvQJQnQO0KT0S2oegenkvJ8FUuY-QS5syyqmT24R2xFQ@mail.gmail.com,https://github.com/postgres/postgres/commit/c05dee191125f2dcbd0ac40534373cfc7266c0da
postgres/postgres,https://github.com/postgres/postgres,75e82b2,Alexander Korotkov,2025-11-18T07:50:12Z,"Optimize shared memory usage for WaitLSNProcInfo  We need separate pairing heaps for different WaitLSNType's, because there might be waiters for different LSN's at the same time.  However, one process can wait only for one type of LSN at a time.  So, no need for inHeap and heapNode fields to be arrays.  Discussion: https://postgr.es/m/CAPpHfdsBR-7sDtXFJ1qpJtKiohfGoj%3DvqzKVjWxtWsWidx7G_A%40mail.gmail.com Author: Alexander Korotkov <aekorotkov@gmail.com> Reviewed-by: Xuneng Zhou <xunengzhou@gmail.com>",https://github.com/postgres/postgres/commit/75e82b2f5a6f5de6b42dbd9ea73be5ff36a931b1
postgres/postgres,https://github.com/postgres/postgres,694b4ab,Michael Paquier,2025-11-18T06:46:43Z,"pg_buffercache: Fix incorrect result cast for relforknumber  pg_buffercache_pages.relforknumber is defined as an int2, but its value was stored with ObjectIdGetDatum() rather than Int16GetDatum() in the result record.  Author: Ashutosh Bapat <ashutosh.bapat.oss@gmail.com> Discussion: https://postgr.es/m/CAExHW5s2_qwSdhKpVnUzjRMf0cf1PvmhUHQDLaFM3QzKbP1OyQ@mail.gmail.com",https://github.com/postgres/postgres/commit/694b4ab33b24dfe1f9cc00fbbd5326f0feadee4a
postgres/postgres,https://github.com/postgres/postgres,fce1342,Michael Paquier,2025-11-18T05:17:54Z,doc: Fix style of description for pg_buffercache_numa.os_page_num  Extracted from a larger patch by the same author.  Author: Bertrand Drouvot <bertranddrouvot.pg@gmail.com> Discussion: https://postgr.es/m/Z/fFA2heH6lpSLlt@ip-10-97-1-34.eu-west-3.compute.internal,https://github.com/postgres/postgres/commit/fce13424b9c56abf8693684ab41d8fca864c1e79
postgres/postgres,https://github.com/postgres/postgres,3edaf29,Amit Kapila,2025-11-18T03:58:55Z,"Rename two columns in pg_stat_subscription_stats.  This patch renames the sync_error_count column to sync_table_error_count in the pg_stat_subscription_stats view. The new name makes the purpose explicit now that a separate column exists to track sequence synchronization errors.  Additionally, the column seq_sync_error_count is renamed to sync_seq_error_count to maintain a consistent naming pattern, making it easier for users to group, and query synchronization related counters.  Author: Vignesh C <vignesh21@gmail.com> Reviewed-by: Peter Smith <smithpb2250@gmail.com> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://postgr.es/m/CALDaNm3WwJmz=-4ybTkhniB-Nf3qmFG9Zx1uKjyLLoPF5NYYXA@mail.gmail.com",https://github.com/postgres/postgres/commit/3edaf29fa5e0d4fd6419c7eb73fd6df5b0406789
postgres/postgres,https://github.com/postgres/postgres,c677f2b,Amit Kapila,2025-11-18T03:48:00Z,"Doc: Use <structfield> markup for sequence fields.  Following commit 980a855c5c, update documentation to use <structfield> for sequence columns. Previously, these were incorrectly marked up as <literal>.  Author: Peter Smith <smithpb2250@gmail.com> Reviewed-by: Chao Li <li.evan.chao@gmail.com> Discussion: https://postgr.es/m/CAHut+PtpDMUE3Kd1p=1ff9pw2HMbgQCpowE_0Hd6gs5v2pKfQg@mail.gmail.com",https://github.com/postgres/postgres/commit/c677f2b09f24a1a92789bcbc0ee6599cfd034f27
postgres/postgres,https://github.com/postgres/postgres,792353f,Bruce Momjian,2025-11-17T23:55:41Z,"doc:  clarify that pg_upgrade preserves ""optimizer"" stats.  Reported-by: Rambabu V  Author: Robert Treat  Discussion: https://postgr.es/m/CADtiZxrUzRRX6edyN2y-7U5HA8KSXttee7K=EFTLXjwG1SCE4A@mail.gmail.com  Backpatch-through: 18",https://github.com/postgres/postgres/commit/792353f7d520482414e3bb5e44ed344cf78b54c6
postgres/postgres,https://github.com/postgres/postgres,a6eac22,Masahiko Sawada,2025-11-17T21:22:20Z,"Use streaming read I/O in BRIN vacuum scan.  This commit implements streaming read I/O for BRIN vacuum scans. Although BRIN indexes tend to be relatively small by design, performance tests have shown performance improvements.  Author: Arseniy Mukhin <arseniy.mukhin.dev@gmail.com> Discussion: https://postgr.es/m/CAE7r3ML01aiq9Th_1OSz7U7Aq2pWbhMLoz5T%2BPXcg8J9ZAPFFA%40mail.gmail.com",https://github.com/postgres/postgres/commit/a6eac2273e6e762003e763f45b880261fbd473a4
postgres/postgres,https://github.com/postgres/postgres,6d969ca,Tom Lane,2025-11-17T20:24:34Z,"Fix pg_crc32c_armv8_choose.c to build with ancient glibc releases.  If you go back as far as the RHEL7 era, <sys/auxv.h> does not provide the HWCAPxxx macros needed with elf_aux_info or getauxval, so you need to get those from the kernel header <asm/hwcap.h> instead.  We knew that for the 32-bit case but failed to extrapolate to the 64-bit case. Oversight in commit aac831caf.  Reported-by: GaoZengqi <pgf00a@gmail.com> Author: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://postgr.es/m/CAFmBtr3Av62-jBzdhFkDHXJF9vQmNtSnH2upwODjnRcsgdTytw@mail.gmail.com Backpatch-through: 18",https://github.com/postgres/postgres/commit/6d969ca687b4b2d4387d318c3fbcf3fc606ea55b
postgres/postgres,https://github.com/postgres/postgres,ed93137,Tom Lane,2025-11-17T18:54:52Z,"Clean up match_orclause_to_indexcol().  Remove bogus stripping of RelabelTypes: that can result in building an output SAOP tree with incorrect exposed exprType for the operands, which might confuse polymorphic operators.  Moreover it demonstrably prevents folding some OR-trees to SAOPs when the RHS expressions have different base types that were coerced to the same type by RelabelTypes.  Reduce prohibition on type_is_rowtype to just disallow type RECORD. We need that because otherwise we would happily fold multiple RECORD Consts into a RECORDARRAY Const even if they aren't the same record type.  (We could allow that perhaps, if we checked that they all have the same typmod, but the case doesn't seem worth that much effort.) However, there is no reason at all to disallow the transformation for named composite types, nor domains over them: as long as we can find a suitable array type we're good.  Remove some assertions that seem rather out of place (it's not this code's duty to verify that the RestrictInfo structure is sane).  Rewrite some comments.  The issues with RelabelType stripping seem severe enough to back-patch this into v18 where the code was introduced.  Author: Tender Wang <tndrwang@gmail.com> Co-authored-by: Tom Lane <tgl@sss.pgh.pa.us> Discussion: https://postgr.es/m/CAHewXN=aH7GQBk4fXU-WaEeVmQWUmBAeNyBfJ3VKzPphyPKUkQ@mail.gmail.com Backpatch-through: 18",https://github.com/postgres/postgres/commit/ed931377abc0403ce137d9a7f7ded67cb9355c8d
postgres/postgres,https://github.com/postgres/postgres,6793d6a,Fujii Masao,2025-11-17T14:24:39Z,"doc: Document default values for some pg_recvlogical options.  The documentation did not previously mention the default values for the --fsync-interval and --plugin options, even though pg_recvlogical --help shows them. This omission made it harder for users to understand the tool's behavior from the documentation alone.  This commit adds the missing default value descriptions for both options to the pg_recvlogical documentation.  Author: Fujii Masao <masao.fujii@gmail.com> Reviewed-by: Laurenz Albe <laurenz.albe@cybertec.at> Discussion: https://postgr.es/m/CAHGQGwFqssPBjkWMFofGq32e_tANOeWN-cM=6biAP3nnFUXMRw@mail.gmail.com",https://github.com/postgres/postgres/commit/6793d6a839c1e4eac495fd0c48b75dc1871425c8
postgres/postgres,https://github.com/postgres/postgres,ab80598,Daniel Gustafsson,2025-11-17T12:37:25Z,Fix typos in logical replication code comments  Author: Chao Li <lic@highgo.com> Reviewed-by: Daniel Gustafsson <daniel@yesql.se> Discussion: https://postgr.es/m/CAEoWx2kt8m7wV39_zOBds5SNXx9EAkDqb5cPshk7Bxw6Js4Zpg@mail.gmail.com,https://github.com/postgres/postgres/commit/ab805989b2ee500cfa060ea36a9133b355bb4f0f
postgres/postgres,https://github.com/postgres/postgres,721bf9c,Daniel Gustafsson,2025-11-17T11:18:18Z,"Mention md5 deprecation in postgresql.conf.sample  PostgreSQL 18 deprecated password_encryption='md5', but the comments for this GUC in the sample configuration file did not mention the deprecation.  Update comments with a notice to make as many users as possible aware of it.  Also add a comment to the related md5_password_warnings GUC while there.  Author: Michael Banck <mbanck@gmx.net> Reviewed-by: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Nathan Bossart <nathandbossart@gmail.com> Reviewed-by: Robert Treat <rob@xzilla.net> Backpatch-through: 18",https://github.com/postgres/postgres/commit/721bf9ce18b63c096104efd419af7e59053a333a
postgres/postgres,https://github.com/postgres/postgres,e76defb,Michael Paquier,2025-11-17T01:44:26Z,"Rework output format of pg_dependencies  The existing format of pg_dependencies uses a single-object JSON structure, with each key value embedding all the knowledge about the set attributes tracked, like: {""1 => 5"": 1.000000, ""5 => 1"": 0.423130}  While this is a very compact format, it is confusing to read and it is difficult to manipulate the values within the object, particularly when tracking multiple attributes.  The new output format introduced in this commit is a JSON array of objects, with: - A key named ""degree"", with a float value. - A key named ""attributes"", with an array of attribute numbers. - A key named ""dependency"", with an attribute number.  The values use the same underlying type as previously when printed, with a new output format that shows now as follows: [{""degree"": 1.000000, ""attributes"": [1], ""dependency"": 5},  {""degree"": 0.423130, ""attributes"": [5], ""dependency"": 1}]  This new format will become handy for a follow-up set of changes, so as it becomes possible to inject extended statistics rather than require an ANALYZE, like in a dump/restore sequence or after pg_upgrade on a new cluster.  This format has been suggested by Tomas Vondra.  The key names are defined in the header introduced by 1f927cce4498, to ease the integration of frontend-specific changes that are still under discussion.  (Again a personal note: if anybody comes up with better name for the keys, of course feel free.)  The bulk of the changes come from the regression tests, where jsonb_pretty() is now used to make the outputs generated easier to parse.  Author: Corey Huinker <corey.huinker@gmail.com> Reviewed-by: Jian He <jian.universality@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Discussion: https://postgr.es/m/CADkLM=dpz3KFnqP-dgJ-zvRvtjsa8UZv8wDAQdqho=qN3kX0Zg@mail.gmail.com",https://github.com/postgres/postgres/commit/e76defbcf09e22941d8cea462e2deef36d43fa04
postgres/postgres,https://github.com/postgres/postgres,1f927cc,Michael Paquier,2025-11-17T00:52:20Z,"Rework output format of pg_ndistinct  The existing format of pg_ndistinct uses a single-object JSON structure where each key is itself a comma-separated list of attnums, like: {""3, 4"": 11, ""3, 6"": 11, ""4, 6"": 11, ""3, 4, 6"": 11}  While this is a very compact format, it is confusing to read and it is difficult to manipulate the values within the object.  The new output format introduced in this commit is an array of objects, with: - A key named ""attributes"", that contains an array of attribute numbers. - A key named ""ndistinct"", represented as an integer.  The values use the same underlying type as previously when printed, with a new output format that shows now as follows: [{""ndistinct"": 11, ""attributes"": [3,4]},  {""ndistinct"": 11, ""attributes"": [3,6]},  {""ndistinct"": 11, ""attributes"": [4,6]},  {""ndistinct"": 11, ""attributes"": [3,4,6]}]  This new format will become handy for a follow-up set of changes, so as it becomes possible to inject extended statistics rather than require an ANALYZE, like in a dump/restore sequence or after pg_upgrade on a new cluster.  This format has been suggested by Tomas Vondra.  The key names are defined in a new header, to ease with the integration of frontend-specific changes that are still under discussion.  (Personal note: I am not specifically wedded to these key names, but if there are better name suggestions for this release, feel free.)  The bulk of the changes come from the regression tests, where jsonb_pretty() is now used to make the outputs generated easier to parse.  Author: Corey Huinker <corey.huinker@gmail.com> Reviewed-by: Jian He <jian.universality@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Discussion: https://postgr.es/m/CADkLM=dpz3KFnqP-dgJ-zvRvtjsa8UZv8wDAQdqho=qN3kX0Zg@mail.gmail.com",https://github.com/postgres/postgres/commit/1f927cce44983ed59a3c1eccc95ad2946ac13b42
postgres/postgres,https://github.com/postgres/postgres,32b2366,Thomas Munro,2025-11-16T23:01:12Z,"Define PS_USE_CLOBBER_ARGV on GNU/Hurd.  Until d2ea2d310dfdc40328aca5b6c52225de78432e01, the PS_USE_PS_STRINGS option was used on the GNU/Hurd. As this option got removed and PS_USE_CLOBBER_ARGV appears to work fine nowadays on the Hurd, define this one to re-enable process title changes on this platform.  In the 14 and 15 branches, the existing test for __hurd__ (added 25 years ago by commit 209aa77d, removed in 16 by the above commit) is left unchanged for now as it was activating slightly different code paths and would need investigation by a Hurd user.  Author: Michael Banck <mbanck@debian.org> Discussion: https://postgr.es/m/CA%2BhUKGJMNGUAqf27WbckYFrM-Mavy0RKJvocfJU%3DJ2XcAZyv%2Bw%40mail.gmail.com Backpatch-through: 16",https://github.com/postgres/postgres/commit/32b236644d33f6877a2ba0a8e18e17c985f502ce
postgres/postgres,https://github.com/postgres/postgres,586d632,David Rowley,2025-11-16T23:27:00Z,"Adjust MemSet macro to use size_t rather than long  Likewise for MemSetAligned.  ""long"" wasn't the most suitable type for these macros as with MSVC in 64-bit builds, sizeof(long) == 4, which is narrower than the processor's word size, therefore these macros had to perform twice as many loops as they otherwise might.  Author: David Rowley <dgrowleyml@gmail.com> Reviewed-by: Heikki Linnakangas <hlinnaka@iki.fi> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Discussion: https://postgr.es/m/CAApHDvoGFjSA3aNyVQ3ivbyc4ST=CC5L-_VjEUQ92HbE2Cxovg@mail.gmail.com",https://github.com/postgres/postgres/commit/586d63214e369283472b5c03fdbaf59833209b3e
postgres/postgres,https://github.com/postgres/postgres,9c047da,David Rowley,2025-11-16T23:26:41Z,"Get rid of long datatype in CATCACHE_STATS enabled builds  ""long"" is 32 bits on Windows 64-bit.  Switch to a datatype that's 64-bit on all platforms.  While we're there, use an unsigned type as these fields count things that have occurred, of which it's not possible to have negative numbers of.  Author: David Rowley <dgrowleyml@gmail.com> Reviewed-by: Heikki Linnakangas <hlinnaka@iki.fi> Reviewed-by: Peter Eisentraut <peter@eisentraut.org> Discussion: https://postgr.es/m/CAApHDvoGFjSA3aNyVQ3ivbyc4ST=CC5L-_VjEUQ92HbE2Cxovg@mail.gmail.com",https://github.com/postgres/postgres/commit/9c047da51f270b25fe03ee114e1de0c64aa9cc18
postgres/postgres,https://github.com/postgres/postgres,e7cde9d,Michael Paquier,2025-11-16T23:01:04Z,"Add test for temporary file removal and WITH HOLD cursor  This new test, added in 009_log_temp_files, checks that the temporary files created by a WITH HOLD cursor are dropped at the end of the transaction where the transaction has been created.  The portal's executor is shutdown in PersistHoldablePortal(), after for example some forced detoast, so as the cursor data can be accessed without requiring a snapshot.  Author: Mircea Cadariu <cadariu.mircea@gmail.com> Discussion: https://postgr.es/m/0a666d28-9080-4239-90d6-f6345bb43468@gmail.com",https://github.com/postgres/postgres/commit/e7cde9dad285acb579b189e82a57fa7b98f23a11
postgres/postgres,https://github.com/postgres/postgres,1b92fe7,Dean Rasheed,2025-11-16T22:14:06Z,"Fix Assert failure in EXPLAIN ANALYZE MERGE with a concurrent update.  When instrumenting a MERGE command containing both WHEN NOT MATCHED BY SOURCE and WHEN NOT MATCHED BY TARGET actions using EXPLAIN ANALYZE, a concurrent update of the target relation could lead to an Assert failure in show_modifytable_info(). In a non-assert build, this would lead to an incorrect value for ""skipped"" tuples in the EXPLAIN output, rather than a crash.  This could happen if the concurrent update caused a matched row to no longer match, in which case ExecMerge() treats the single originally matched row as a pair of not matched rows, and potentially executes 2 not-matched actions for the single source row. This could then lead to a state where the number of rows processed by the ModifyTable node exceeds the number of rows produced by its source node, causing ""skipped_path"" in show_modifytable_info() to be negative, triggering the Assert.  Fix this in ExecMergeMatched() by incrementing the instrumentation tuple count on the source node whenever a concurrent update of this kind is detected, if both kinds of merge actions exist, so that the number of source rows matches the number of actions potentially executed, and the ""skipped"" tuple count is correct.  Back-patch to v17, where support for WHEN NOT MATCHED BY SOURCE actions was introduced.  Bug: #19111 Reported-by: Dilip Kumar <dilipbalaut@gmail.com> Author: Dean Rasheed <dean.a.rasheed@gmail.com> Reviewed-by: Dilip Kumar <dilipbalaut@gmail.com> Discussion: https://postgr.es/m/19111-5b06624513d301b3@postgresql.org Backpatch-through: 17",https://github.com/postgres/postgres/commit/1b92fe7bb9d8b8977bf7e48912b12f97f128ec1d
postgres/postgres,https://github.com/postgres/postgres,2b54a1a,David Rowley,2025-11-16T21:51:26Z,"Doc: include MERGE in variable substitution command list  Backpatch to 15, where MERGE was introduced.  Reported-by: <emorgunov@mail.ru> Author: David Rowley <dgrowleyml@gmail.com> Discussion: https://postgr.es/m/176278494385.770.15550176063450771532@wrigleys.postgresql.org Backpatch-through: 15",https://github.com/postgres/postgres/commit/2b54a1abdbb09a4b170bca82726dabe7b2d6555b
postgres/postgres,https://github.com/postgres/postgres,23792d7,Alexander Korotkov,2025-11-15T10:16:54Z,Fix incorrect function name in comments  Update comments to reference WaitForLSN() instead of the outdated WaitForLSNReplay() function name.  Discussion: https://postgr.es/m/CABPTF7UieOYbOgH3EnQCasaqcT1T4N6V2wammwrWCohQTnD_Lw%40mail.gmail.com Author: Xuneng Zhou <xunengzhou@gmail.com> Reviewed-by: Alexander Korotkov <aekorotkov@gmail.com>,https://github.com/postgres/postgres/commit/23792d7381583d04c4bbd0a8507566401ec013d3
postgres/postgres,https://github.com/postgres/postgres,ede6ace,Alexander Korotkov,2025-11-15T10:16:23Z,"Fix WaitLSNWakeup() fast-path check for InvalidXLogRecPtr  WaitLSNWakeup() incorrectly returned early when called with InvalidXLogRecPtr (meaning ""wake all waiters""), because the fast-path check compared minWaitedLSN > 0 without validating currentLSN first. This caused WAIT FOR LSN commands to wait indefinitely during standby promotion until random signals woke them.  Add an XLogRecPtrIsValid() check before the comparison so that InvalidXLogRecPtr bypasses the fast-path and wakes all waiters immediately.  Discussion: https://postgr.es/m/CABPTF7UieOYbOgH3EnQCasaqcT1T4N6V2wammwrWCohQTnD_Lw%40mail.gmail.com Author: Xuneng Zhou <xunengzhou@gmail.com> Reviewed-by: Alexander Korotkov <aekorotkov@gmail.com>",https://github.com/postgres/postgres/commit/ede6acef49673df0a880edae405ca69393bb48d0
postgres/postgres,https://github.com/postgres/postgres,446568c,Daniel Gustafsson,2025-11-14T22:44:56Z,"Add test for postgresql.conf.sample line syntax  All GUCs in postgresql.conf.sample should be set to the default value and be commented out.  This syntax was however not tested for, making omissions easy to miss.  Add a test which check all lines for syntax.  Author: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Andrew Dunstan <andrew@dunslane.net> Discussion: https://postgr.es/m/19727040-3EE4-4719-AF4F-2548544113D7@yesql.se",https://github.com/postgres/postgres/commit/446568c22207795da02e26b6b2956a61bd17e912
postgres/postgres,https://github.com/postgres/postgres,478c481,Nathan Bossart,2025-11-14T19:45:04Z,"Comment out autovacuum_worker_slots in postgresql.conf.sample.  All settings in this file should be commented out.  In addition to fixing that, also fix the indentation for this line.  Oversight in commit c758119e5b.  Reported-by: Daniel Gustafsson <daniel@yesql.se> Author: Daniel Gustafsson <daniel@yesql.se> Discussion: https://postgr.es/m/19727040-3EE4-4719-AF4F-2548544113D7%40yesql.se Backpatch-through: 18",https://github.com/postgres/postgres/commit/478c4814a05262c0312c813bf393c4736d76f3f9
postgres/postgres,https://github.com/postgres/postgres,7506bdb,Nathan Bossart,2025-11-14T19:20:09Z,"Add note about CreateStatistics()'s selective use of check_rights.  Commit 5e4fcbe531 added a check_rights parameter to this function for use by ALTER TABLE commands that re-create statistics objects. However, we intentionally ignore check_rights when verifying relation ownership because this function's lookup could return a different answer than the caller's.  This commit adds a note to this effect so that we remember it down the road.  Reviewed-by: Noah Misch <noah@leadboat.com> Backpatch-through: 14",https://github.com/postgres/postgres/commit/7506bdbbf45ea757f67162a352196976379ccdd7
postgres/postgres,https://github.com/postgres/postgres,4c00960,Bruce Momjian,2025-11-14T15:45:59Z,doc:  clarify that logical slots track transaction activity  Previously it only mentioned WAL retention.  Discussion: https://postgr.es/m/pexmenhqptw5h4ma4qasz3cvjtynivxprqifgghdjtmkxdig2g@djg7bk2p6pts  Backpatch-through: master,https://github.com/postgres/postgres/commit/4c00960772237325bcdf75f1a068c712e392a69b
postgres/postgres,https://github.com/postgres/postgres,43e6929,Bruce Momjian,2025-11-14T14:08:53Z,"doc:  double-quote use of %f, %p, and %r in literal commands.  Path expansion might expose characters like spaces which would cause command failure, so double-quote the examples.  While %f doesn't need quoting since it uses a fixed character set, it is best to be consistent.  Discussion: https://postgr.es/m/aROPCQCfvKp9Htk4@momjian.us  Backpatch-through: master",https://github.com/postgres/postgres/commit/43e6929bb2945553df021874914ade88743abc1f
postgres/postgres,https://github.com/postgres/postgres,a554389,Bruce Momjian,2025-11-14T13:55:42Z,"doc:  remove verbiage about ""receiving"" data from rep. slots  The slots are just LSN markers, not something to receive from.  Backpatch-through: master",https://github.com/postgres/postgres/commit/a554389fb5f96baba834c28bd4fc802fa1c8065f
postgres/postgres,https://github.com/postgres/postgres,4aa0ac0,Fujii Masao,2025-11-14T13:40:39Z,"pgbench: Fix assertion failure with multiple \syncpipeline in pipeline mode.  Previously, when pgbench ran a custom script that triggered retriable errors (e.g., deadlocks) followed by multiple \syncpipeline commands in pipeline mode, the following assertion failure could occur:      Assertion failed: (res == ((void*)0)), function discardUntilSync, file pgbench.c, line 3594.  The issue was that discardUntilSync() assumed a pipeline sync result (PGRES_PIPELINE_SYNC) would always be followed by either another sync result or NULL. This assumption was incorrect: when multiple sync requests were sent, a sync result could instead be followed by another result type. In such cases, discardUntilSync() mishandled the results, leading to the assertion failure.  This commit fixes the issue by making discardUntilSync() correctly handle cases where a pipeline sync result is followed by other result types. It now continues discarding results until another pipeline sync followed by NULL is reached.  Backpatched to v17, where support for \syncpipeline command in pgbench was introduced.  Author: Yugo Nagata <nagata@sraoss.co.jp> Reviewed-by: Chao Li <lic@highgo.com> Reviewed-by: Fujii Masao <masao.fujii@gmail.com> Discussion: https://postgr.es/m/20251111105037.f3fc554616bc19891f926c5b@sraoss.co.jp Backpatch-through: 17",https://github.com/postgres/postgres/commit/4aa0ac05765edf6b5f0c13e18ac677287ce78206
postgres/postgres,https://github.com/postgres/postgres,e4018f8,Álvaro Herrera,2025-11-14T10:29:50Z,Doc: add IDs to copy.sgml's <varlistentry> and <refsect1>  In the spirit of commit 78ee60ed84bb.  Author: jian he <jian.universality@gmail.com> Discussion: https://postgr.es/m/CACJufxFsPXCwSVR+_vScZ3bysh4-dpE19iVyeta30uNHwnwnSw@mail.gmail.com,https://github.com/postgres/postgres/commit/e4018f891dec09ff95ac97e5b1a2307349aeeffa
postgres/postgres,https://github.com/postgres/postgres,9106904,Michael Paquier,2025-11-14T05:37:10Z,"Revert ""Drop unnamed portal immediately after execution to completion""  This reverts commit 1fd981f05369, based on concerns that the logging improvements do not justify the protocol breakage of dropping an unnamed portal once its execution has completed.  It seems unlikely that one would try to send an execute or describe message after the portal has been used, but if they do such post-completion messages would not be able to process as the previous versions.  Let's revert this change for now so as we keep compatibility and consider a different solution.  The tests added by 76bba033128a track the pre-1fd981f05369 behavior, and are still valid.  Discussion: https://postgr.es/m/CA+TgmoYFJyJNQw3RT7veO3M2BWRE9Aw4hprC5rOcawHZti-f8g@mail.gmail.com",https://github.com/postgres/postgres/commit/910690415b661186ae44e3b5e538e23eaa48de1b
postgres/postgres,https://github.com/postgres/postgres,8fa6b90,Bruce Momjian,2025-11-14T02:53:13Z,"doc:  adjust ""Replication Slot"" to mention physical & logical  Much of the ""Replication Slot"" chapter applies to physical and logical slots, but it was sloppy in mentioning mostly physical slots.  This patch clarified which parts of the text apply to which slot types.  This chapter is referenced from the logical slot/subscriber chapter, so it needs to do double duty.  Backpatch-through: master",https://github.com/postgres/postgres/commit/8fa6b9030d689c856578e5769088a2527b7283d6
postgres/postgres,https://github.com/postgres/postgres,ada78cd,Bruce Momjian,2025-11-14T02:35:28Z,"doc:  clarify ""logical"" replication slots  Also mention that logical replication slots are created by default when subscriptions are created.  This should clarify the text.  Backpatch-through: master",https://github.com/postgres/postgres/commit/ada78cd7f80a818de1924180ff5a0647cf59ccfb
postgres/postgres,https://github.com/postgres/postgres,a5b69e3,Bruce Momjian,2025-11-14T01:44:00Z,"doc: clarify ""physical"" replication slot creation on the primary  Previously it was not clear that ""physical"" replication slots were being discussed, and that they needed to be created on the primary and not the standby.  Backpatch-through: master",https://github.com/postgres/postgres/commit/a5b69e30731fb623715ecf4c8073c0f2dee41678
postgres/postgres,https://github.com/postgres/postgres,acbc9be,Bruce Momjian,2025-11-13T23:12:37Z,doc:  reorder logical replication benefits in a logical order  The previous ordering was hard to understand and remember.  Also adjust wording to be more consistent with surrounding items.  Backpatch-through: master,https://github.com/postgres/postgres/commit/acbc9beaaed6ee88416e1dcef5df77fd5baba0be
postgres/postgres,https://github.com/postgres/postgres,d22cc73,Daniel Gustafsson,2025-11-13T15:35:07Z,"Document that pg_getaddrinfo_all does not accept null hints  While the underlying getaddrinfo call accepts a null pointer for the hintp parameter, pg_getaddrinfo_all does not.  Document this difference with a comment to make it clear.  Author: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Reported-by: Sergey Tatarintsev <s.tatarintsev@postgrespro.ru> Discussion: https://postgr.es/m/1e5efc94-407e-40b8-8b10-4d25f823c6d7@postgrespro.ru",https://github.com/postgres/postgres/commit/d22cc7326ce0fe5033f2c6e3f711047d263c1c86
postgres/postgres,https://github.com/postgres/postgres,7dc4fa9,Dean Rasheed,2025-11-13T12:00:56Z,"doc: Improve description of RLS policies applied by command type.  On the CREATE POLICY page, the ""Policies Applied by Command Type"" table was missing MERGE ... THEN DELETE and some of the policies applied during INSERT ... ON CONFLICT and MERGE. Fix that, and try to improve readability by listing the various MERGE cases separately, rather than together with INSERT/UPDATE/DELETE. Mention COPY ... TO along with SELECT, since it behaves in the same way. In addition, document which policy violations cause errors to be thrown, and which just cause rows to be silently ignored.  Also, a paragraph above the table states that INSERT ... ON CONFLICT DO UPDATE only checks the WITH CHECK expressions of INSERT policies for rows appended to the relation by the INSERT path, which is incorrect -- all rows proposed for insertion are checked, regardless of whether they end up being inserted. Fix that, and also mention that the same applies to INSERT ... ON CONFLICT DO NOTHING.  In addition, in various other places on that page, clarify how the different types of policy are applied to different commands, and whether or not errors are thrown when policy checks do not pass.  Backpatch to all supported versions. Prior to v17, MERGE did not support RETURNING, and so MERGE ... THEN INSERT would never check new rows against SELECT policies. Prior to v15, MERGE was not supported at all.  Author: Dean Rasheed <dean.a.rasheed@gmail.com> Reviewed-by: Viktor Holmberg <v@viktorh.net> Reviewed-by: Jian He <jian.universality@gmail.com> Discussion: https://postgr.es/m/CAEZATCWqnfeChjK=n1V_dYZT4rt4mnq+ybf9c0qXDYTVMsy8pg@mail.gmail.com Backpatch-through: 14",https://github.com/postgres/postgres/commit/7dc4fa91413d62c47f41043c0fce0be536f51e13
postgres/postgres,https://github.com/postgres/postgres,017249b,Thomas Munro,2025-11-13T09:56:08Z,Add some missing #include <limits.h>.  These files relied on transitive inclusion via port/atomics.h for constants CHAR_BIT and INT_MAX.  Reviewed-by: Heikki Linnakangas <hlinnaka@iki.fi> Discussion: https://postgr.es/m/536409d2-c9df-4ef3-808d-1ffc3182868c@iki.fi,https://github.com/postgres/postgres/commit/017249b828880073140a3e4cc13858804b4418de
postgres/postgres,https://github.com/postgres/postgres,e6c9186,Michael Paquier,2025-11-13T05:27:24Z,Add commit c2b0e3a0351e to .git-blame-ignore-revs.,https://github.com/postgres/postgres/commit/e6c9186e68382d2a91e23da9225261a781a667f7
postgres/postgres,https://github.com/postgres/postgres,c2b0e3a,Michael Paquier,2025-11-13T05:25:21Z,"Fix indentation issue  Issue introduced by 84fb27511dbe.  I have missed this diff while adding pgoff_t to the typedef list of pgindent, while addressing a separate indentation issue.  Per buildfarm member koel.",https://github.com/postgres/postgres/commit/c2b0e3a0351e021dea9b61fe2f759570d3fedb70
postgres/postgres,https://github.com/postgres/postgres,84fb275,Michael Paquier,2025-11-13T03:41:40Z,"Replace off_t by pgoff_t in I/O routines  PostgreSQL's Windows port has never been able to handle files larger than 2GB due to the use of off_t for file offsets, only 32-bit on Windows.  This causes signed integer overflow at exactly 2^31 bytes when trying to handle files larger than 2GB, for the routines touched by this commit.  Note that large files are forbidden by ./configure (3c6248a828af) and meson (recent change, see 79cd66f28c65).  This restriction also exists in v16 and older versions for the now-dead MSVC scripts.  The code base already defines pgoff_t as __int64 (64-bit) on Windows for this purpose, and some function declarations in headers use it, but many internals still rely on off_t.  This commit switches more routines to use pgoff_t, offering more portability, for areas mainly related to file extensions and storage.  These are not critical for WAL segments yet, which have currently a maximum size allowed of 1GB (well, this opens the door at allowing a larger size for them).  This matters more for segment files if we want to lift the large file restriction in ./configure and meson in the future, which would make sense to remove once/if all traces of off_t are gone from the tree.  This can additionally matter for out-of-core code that may want files larger than 2GB in places where off_t is four bytes in size.  Note that off_t is still used in other parts of the tree like buffile.c, WAL sender/receiver, base backup, pg_combinebackup, etc. These other code paths can be addressed separately, and their update will be required if we want to remove the large file restriction in the future.  This commit is a good first cut in itself towards more portability, hopefully.  On Unix-like systems, pgoff_t is defined as off_t, so this change only affects Windows behavior.  Author: Bryan Green <dbryan.green@gmail.com> Reviewed-by: Thomas Munro <thomas.munro@gmail.com> Reviewed-by: Michael Paquier <michael@paquier.xyz> Discussion: https://postgr.es/m/0f238ff4-c442-42f5-adb8-01b762c94ca1@gmail.com",https://github.com/postgres/postgres/commit/84fb27511dbeaa0fb0d48249083d71f6cbbd4b98
postgres/postgres,https://github.com/postgres/postgres,705601c,Fujii Masao,2025-11-12T23:44:33Z,"Fix incorrect assignment of InvalidXLogRecPtr to a non-LSN variable.  pg_logical_slot_get_changes_guts() previously assigned InvalidXLogRecPtr to the local variable upto_nchanges, which is of type int32, not XLogRecPtr. While this caused no functional issue since InvalidXLogRecPtr is defined as 0, it was semantically incorrect.  This commit fixes the issue by updating pg_logical_slot_get_changes_guts() to set upto_nchanges to 0 instead of InvalidXLogRecPtr.  No backpatch is needed, as the previous behavior was harmless.  Author: Fujii Masao <masao.fujii@gmail.com> Reviewed-by: Steven Niu <niushiji@gmail.com> Reviewed-by: Xuneng Zhou <xunengzhou@gmail.com> Discussion: https://postgr.es/m/CAHGQGwHKHuR5NGnGxU3+ebz7cbC1ZAR=AgG4Bueq==Lj6iX8Sw@mail.gmail.com",https://github.com/postgres/postgres/commit/705601c5aeab56aef62dd69ac2b7acf662f08e9c
postgres/postgres,https://github.com/postgres/postgres,180e7ab,Nathan Bossart,2025-11-12T21:13:08Z,Remove obsolete autovacuum comment.  This comment seems to refer to some stuff that was removed during development in 2005.  Reviewed-by: David Rowley <dgrowleyml@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://postgr.es/m/aRJFDxKJLFE_1Iai%40nathan,https://github.com/postgres/postgres/commit/180e7abe68040375b77450d389dafbb0f11186e7
postgres/postgres,https://github.com/postgres/postgres,c5c7428,Nathan Bossart,2025-11-12T20:57:48Z,"test_dsa: Avoid leaking LWLock tranches.  Since this is a test module, leaking a couple of LWLock tranches is fine, but we want to discourage that pattern in third-party code. This commit teaches the module to create only one tranche and to store its ID in shared memory for use by other backends.  Reported-by: Alexander Lakhin <exclusion@gmail.com> Reviewed-by: Sami Imseih <samimseih@gmail.com> Discussion: https://postgr.es/m/dd36d384-55df-4fc2-825c-5bc56c950fa9%40gmail.com",https://github.com/postgres/postgres/commit/c5c74282f2ea222beb7e07fc91b7afd7a06020c2
postgres/postgres,https://github.com/postgres/postgres,1165a93,Nathan Bossart,2025-11-12T20:30:11Z,"Teach DSM registry to ERROR if attaching to an uninitialized entry.  If DSM entry initialization fails, backends could try to use an uninitialized DSM segment, DSA, or dshash table (since the entry is still added to the registry).  To fix, keep track of whether initialization completed, and ERROR if a backend tries to attach to an uninitialized entry.  We could instead retry initialization as needed, but that seemed complicated, error prone, and unlikely to help most cases.  Furthermore, such problems probably indicate a coding error.  Reported-by: Alexander Lakhin <exclusion@gmail.com> Reviewed-by: Sami Imseih <samimseih@gmail.com> Discussion: https://postgr.es/m/dd36d384-55df-4fc2-825c-5bc56c950fa9%40gmail.com Backpatch-through: 17",https://github.com/postgres/postgres/commit/1165a933aab1355757a43cfd9193b6cce06f573b
postgres/postgres,https://github.com/postgres/postgres,0bdc777,Heikki Linnakangas,2025-11-12T19:19:03Z,"Clear 'xid' in dummy async notify entries written to fill up pages  Before we started to freeze async notify entries (commit 8eeb4a0f7c), no one looked at the 'xid' on an entry with invalid 'dboid'. But now we might actually need to freeze it later. Initialize them with InvalidTransactionId to begin with, to avoid that work later.  Álvaro pointed this out in review of commit 8eeb4a0f7c, but I forgot to include this change there.  Author: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://www.postgresql.org/message-id/202511071410.52ll56eyixx7@alvherre.pgsql Backpatch-through: 14",https://github.com/postgres/postgres/commit/0bdc777e80071abd77674f1e66258d410a010aa9
postgres/postgres,https://github.com/postgres/postgres,797e9ea,Heikki Linnakangas,2025-11-12T18:59:44Z,"Fix remaining race condition with CLOG truncation and LISTEN/NOTIFY  Previous commit fixed a bug where VACUUM would truncate the CLOG that's still needed to check the commit status of XIDs in the async notify queue, but as mentioned in the commit message, it wasn't a full fix. If a backend is executing asyncQueueReadAllNotifications() and has just made a local copy of an async SLRU page which contains old XIDs, vacuum can concurrently truncate the CLOG covering those XIDs, and the backend still gets an error when it calls TransactionIdDidCommit() on those XIDs in the local copy. This commit fixes that race condition.  To fix, hold the SLRU bank lock across the TransactionIdDidCommit() calls in NOTIFY processing.  Per Tom Lane's idea. Backpatch to all supported versions.  Reviewed-by: Joel Jacobson <joel@compiler.org> Reviewed-by: Arseniy Mukhin <arseniy.mukhin.dev@gmail.com> Discussion: https://www.postgresql.org/message-id/2759499.1761756503@sss.pgh.pa.us Backpatch-through: 14",https://github.com/postgres/postgres/commit/797e9ea6e54b06c3e6c79b468dab89fdbf6be179
postgres/postgres,https://github.com/postgres/postgres,8eeb4a0,Heikki Linnakangas,2025-11-12T18:59:36Z,"Fix bug where we truncated CLOG that was still needed by LISTEN/NOTIFY  The async notification queue contains the XID of the sender, and when processing notifications we call TransactionIdDidCommit() on the XID. But we had no safeguards to prevent the CLOG segments containing those XIDs from being truncated away. As a result, if a backend didn't for some reason process its notifications for a long time, or when a new backend issued LISTEN, you could get an error like:  test=# listen c21; ERROR:  58P01: could not access status of transaction 14279685 DETAIL:  Could not open file ""pg_xact/000D"": No such file or directory. LOCATION:  SlruReportIOError, slru.c:1087  To fix, make VACUUM ""freeze"" the XIDs in the async notification queue before truncating the CLOG. Old XIDs are replaced with FrozenTransactionId or InvalidTransactionId.  Note: This commit is not a full fix. A race condition remains, where a backend is executing asyncQueueReadAllNotifications() and has just made a local copy of an async SLRU page which contains old XIDs, while vacuum concurrently truncates the CLOG covering those XIDs. When the backend then calls TransactionIdDidCommit() on those XIDs from the local copy, you still get the error. The next commit will fix that remaining race condition.  This was first reported by Sergey Zhuravlev in 2021, with many other people hitting the same issue later. Thanks to: - Alexandra Wang, Daniil Davydov, Andrei Varashen and Jacques Combrink   for investigating and providing reproducable test cases, - Matheus Alcantara and Arseniy Mukhin for review and earlier proposed   patches to fix this, - Álvaro Herrera and Masahiko Sawada for reviews, - Yura Sokolov aka funny-falcon for the idea of marking transactions   as committed in the notification queue, and - Joel Jacobson for the final patch version. I hope I didn't forget   anyone.  Backpatch to all supported versions. I believe the bug goes back all the way to commit d1e027221d, which introduced the SLRU-based async notification queue.  Discussion: https://www.postgresql.org/message-id/16961-25f29f95b3604a8a@postgresql.org Discussion: https://www.postgresql.org/message-id/18804-bccbbde5e77a68c2@postgresql.org Discussion: https://www.postgresql.org/message-id/CAK98qZ3wZLE-RZJN_Y%2BTFjiTRPPFPBwNBpBi5K5CU8hUHkzDpw@mail.gmail.com Backpatch-through: 14",https://github.com/postgres/postgres/commit/8eeb4a0f7c061ece7a8836e738ea8b7764617d3b
postgres/postgres,https://github.com/postgres/postgres,1b46990,Heikki Linnakangas,2025-11-12T18:59:28Z,"Escalate ERRORs during async notify processing to FATAL  Previously, if async notify processing encountered an error, we would report the error to the client and advance our read position past the offending entry to prevent trying to process it over and over again. Trying to continue after an error has a few problems however:  - We have no way of telling the client that a notification was   lost. They get an ERROR, but that doesn't tell you much. As such,   it's not clear if keeping the connection alive after losing a   notification is a good thing. Depending on the application logic,   missing a notification could cause the application to get stuck   waiting, for example.  - If the connection is idle, PqCommReadingMsg is set and any ERROR is   turned into FATAL anyway.  - We bailed out of the notification processing loop on first error   without processing any subsequent notifications. The subsequent   notifications would not be processed until another notify interrupt   arrives. For example, if there were two notifications pending, and   processing the first one caused an ERROR, the second notification   would not be processed until someone sent a new NOTIFY.  This commit changes the behavior so that any ERROR while processing async notifications is turned into FATAL, causing the client connection to be terminated. That makes the behavior more consistent as that's what happened in idle state already, and terminating the connection is a clear signal to the application that it might've missed some notifications.  The reason to do this now is that the next commits will change the notification processing code in a way that would make it harder to skip over just the offending notification entry on error.  Reviewed-by: Matheus Alcantara <matheusssilv97@gmail.com> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Reviewed-by: Arseniy Mukhin <arseniy.mukhin.dev@gmail.com> Discussion: https://www.postgresql.org/message-id/fedbd908-4571-4bbe-b48e-63bfdcc38f64@iki.fi Backpatch-through: 14",https://github.com/postgres/postgres/commit/1b4699090eaf54d35caf13024957fb5fdefde630
postgres/postgres,https://github.com/postgres/postgres,d36acd6,Daniel Gustafsson,2025-11-12T16:04:35Z,doc: Document effects of ownership change on privileges  Explicitly document that privileges are transferred along with the ownership. Backpatch to all supported versions since this behavior has always been present.  Author: Laurenz Albe <laurenz.albe@cybertec.at> Reviewed-by: Daniel Gustafsson <daniel@yesql.se> Reviewed-by: David G. Johnston <david.g.johnston@gmail.com> Reviewed-by: Tom Lane <tgl@sss.pgh.pa.us> Reviewed-by: Josef Šimánek <josef.simanek@gmail.com> Reported-by: Gilles Parc <gparc@free.fr> Discussion: https://postgr.es/m/2023185982.281851219.1646733038464.JavaMail.root@zimbra15-e2.priv.proxad.net Backpatch-through: 14,https://github.com/postgres/postgres/commit/d36acd6f5c924bfe6a8618df49512cf05f898324
postgres/postgres,https://github.com/postgres/postgres,877a024,Álvaro Herrera,2025-11-12T15:39:55Z,"Split out innards of pg_tablespace_location()  This creates a src/backend/catalog/pg_tablespace.c supporting file containing a new function get_tablespace_location(), which lets the code underlying pg_tablespace_location() be reused for other purposes.  Author: Manni Wood <manni.wood@enterprisedb.com> Author: Nishant Sharma <nishant.sharma@enterprisedb.com> Reviewed-by: Vaibhav Dalvi <vaibhav.dalvi@enterprisedb.com> Reviewed-by: Ian Lawrence Barwick <barwick@gmail.com> Reviewed-by: Jim Jones <jim.jones@uni-muenster.de> Reviewed-by: Álvaro Herrera <alvherre@kurilemu.de> Discussion: https://postgr.es/m/CAKWEB6rmnmGKUA87Zmq-s=b3Scsnj02C0kObQjnbL2ajfPWGEw@mail.gmail.com",https://github.com/postgres/postgres/commit/877a024902a73732d9f976804aee9699dcbe1d90
postgres/postgres,https://github.com/postgres/postgres,a1f7f91,Alexander Korotkov,2025-11-12T14:11:14Z,Add tab completion support for the WAIT FOR command  This commit implements tab completion for the WAIT FOR LSN command in psql.  Discussion: https://postgr.es/m/CABPTF7WnLPKcoTGCGge1dDpOieZ2HGF7OVqhNXDcRLPPdSw%3DxA%40mail.gmail.com Author: Xuneng Zhou <xunengzhou@gmail.com> Reviewed-by: Alexander Korotkov <aekorotkov@gmail.com>,https://github.com/postgres/postgres/commit/a1f7f91be2c24c0a9e8d5b9e75bc43437d5476c2
